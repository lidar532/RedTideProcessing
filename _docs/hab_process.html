<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.361">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>RedTideProcessing - Colabs Online Processing for HABSpec</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="styles.css">
<meta property="og:title" content="RedTideProcessing - Colabs Online Processing for HABSpec">
<meta property="og:description" content="">
<meta property="og:site-name" content="RedTideProcessing">
<meta name="twitter:title" content="RedTideProcessing - Colabs Online Processing for HABSpec">
<meta name="twitter:description" content="">
<meta name="twitter:card" content="summary">
</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">RedTideProcessing</span>
    </a>
  </div>
        <div class="quarto-navbar-tools ms-auto">
</div>
          <div id="quarto-search" class="" title="Search"></div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./hab_process.html">Colabs Online Processing for HABSpec</a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">RedTideProcessing</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./redtideprocessing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">RedTideProcessing</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./hab_process.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Colabs Online Processing for HABSpec</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#run-these-cells-first-to-get-started." id="toc-run-these-cells-first-to-get-started." class="nav-link active" data-scroll-target="#run-these-cells-first-to-get-started.">Run these cells first to get started.</a></li>
  <li><a href="#load-required-local-functions." id="toc-load-required-local-functions." class="nav-link" data-scroll-target="#load-required-local-functions.">Load required local functions.</a>
  <ul class="collapse">
  <li><a href="#hyperspec-class-methods" id="toc-hyperspec-class-methods" class="nav-link" data-scroll-target="#hyperspec-class-methods">HyperSpec class &amp; methods</a></li>
  <li><a href="#local-required-methods." id="toc-local-required-methods." class="nav-link" data-scroll-target="#local-required-methods.">Local required methods.</a></li>
  </ul></li>
  <li><a href="#process-data" id="toc-process-data" class="nav-link" data-scroll-target="#process-data">Process data</a></li>
  <li><a href="#plots-graphs-maps" id="toc-plots-graphs-maps" class="nav-link" data-scroll-target="#plots-graphs-maps">Plots, Graphs, Maps</a>
  <ul class="collapse">
  <li><a href="#gps-plots-maps" id="toc-gps-plots-maps" class="nav-link" data-scroll-target="#gps-plots-maps">GPS Plots, Maps</a></li>
  <li><a href="#plot-a-single-json-spectra-file-v2." id="toc-plot-a-single-json-spectra-file-v2." class="nav-link" data-scroll-target="#plot-a-single-json-spectra-file-v2.">Plot a single json spectra file v2.</a>
  <ul class="collapse">
  <li><a href="#plot-settings." id="toc-plot-settings." class="nav-link" data-scroll-target="#plot-settings.">Plot Settings.</a></li>
  <li><a href="#plot-a-single-spectra-and-nearby-photo" id="toc-plot-a-single-spectra-and-nearby-photo" class="nav-link" data-scroll-target="#plot-a-single-spectra-and-nearby-photo">Plot a single Spectra and nearby Photo</a></li>
  </ul></li>
  <li><a href="#plot-animated-spectra-and-photos-along-a-selected-flightline." id="toc-plot-animated-spectra-and-photos-along-a-selected-flightline." class="nav-link" data-scroll-target="#plot-animated-spectra-and-photos-along-a-selected-flightline.">Plot Animated spectra and photos along a selected flightline.</a>
  <ul class="collapse">
  <li><a href="#animate-spectra-from-a-flightline" id="toc-animate-spectra-from-a-flightline" class="nav-link" data-scroll-target="#animate-spectra-from-a-flightline">Animate Spectra from a flightline</a></li>
  <li><a href="#plot-signals-vs-time" id="toc-plot-signals-vs-time" class="nav-link" data-scroll-target="#plot-signals-vs-time">Plot Signals vs time</a></li>
  <li><a href="#plot-chl_fl-as-filled-circles-vs-latlon" id="toc-plot-chl_fl-as-filled-circles-vs-latlon" class="nav-link" data-scroll-target="#plot-chl_fl-as-filled-circles-vs-latlon">Plot CHL_Fl as filled circles vs lat/lon</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#code-under-development" id="toc-code-under-development" class="nav-link" data-scroll-target="#code-under-development">Code under Development</a>
  <ul class="collapse">
  <li><a href="#iterate-over-all-json-and-image-files" id="toc-iterate-over-all-json-and-image-files" class="nav-link" data-scroll-target="#iterate-over-all-json-and-image-files">Iterate over all json, and image files</a></li>
  <li><a href="#work-with-files-and-dirs" id="toc-work-with-files-and-dirs" class="nav-link" data-scroll-target="#work-with-files-and-dirs">Work with files and dirs</a></li>
  </ul></li>
  <li><a href="#generate-habspec-class-library" id="toc-generate-habspec-class-library" class="nav-link" data-scroll-target="#generate-habspec-class-library">Generate HabSpec Class library</a></li>
  <li><a href="#references" id="toc-references" class="nav-link" data-scroll-target="#references">References</a>
  <ul class="collapse">
  <li><a href="#links" id="toc-links" class="nav-link" data-scroll-target="#links">Links</a></li>
  </ul></li>
  </ul>
<div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/lidar532/RedTideProcessing/issues/new" class="toc-action">Report an issue</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Colabs Online Processing for HABSpec</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<!-- WARNING: THIS FILE WAS AUTOGENERATED! DO NOT EDIT! -->
<section id="run-these-cells-first-to-get-started." class="level1">
<h1>Run these cells first to get started.</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co">#@title Copy and untar to 2021-0717 NO-PIX data from the Gdrive to /content { form-width: "30%" }</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="va">__name__</span> <span class="op">==</span> <span class="st">'__main__'</span>:</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>  <span class="op">!</span> cp <span class="op">/</span>content<span class="op">/</span>drive<span class="op">/</span>MyDrive<span class="op">/</span>Missions<span class="op">/</span><span class="dv">2021</span><span class="op">-</span><span class="dv">0</span><span class="er">717</span><span class="op">-</span>HAB<span class="op">-</span>pie<span class="op">-</span>NO<span class="op">-</span>PIX.tar.gz <span class="op">/</span>content<span class="op">/</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>  <span class="op">!</span> tar <span class="op">-</span>xzf <span class="op">/</span>content<span class="op">/</span>drive<span class="op">/</span>MyDrive<span class="op">/</span>Missions<span class="op">/</span><span class="dv">2021</span><span class="op">-</span><span class="dv">0</span><span class="er">717</span><span class="op">-</span>HAB<span class="op">-</span>pie<span class="op">-</span>NO<span class="op">-</span>PIX.tar.gz</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>  <span class="bu">print</span>(<span class="st">'Operation completed.'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="load-required-local-functions." class="level1">
<h1>Load required local functions.</h1>
<section id="hyperspec-class-methods" class="level3">
<h3 class="anchored" data-anchor-id="hyperspec-class-methods">HyperSpec class &amp; methods</h3>
<section id="docs" class="level4">
<h4 class="anchored" data-anchor-id="docs">Docs</h4>
<section id="methods-and-data-in-hyperspectral-class" class="level5">
<h5 class="anchored" data-anchor-id="methods-and-data-in-hyperspectral-class">methods and Data in HyperSpectral Class:</h5>
<p>Data: * Fraunhofer_lines * HG_lines * Xpixels * wavelengths</p>
<p>Functions: * def configure_json_spectra(f) * def calibrate_using_2_wavelengths(self, pixel0=0, wavelength0=0, pixel1=0, wavelength1=0 ) * def read_spectra(self, f, remove_bias = True, y_average=True ) * def hhmmss_to_sod(self, hhmmss, Usecs=0) * def nearest_rgb_image(self, fn) *</p>
</section>
</section>
<section id="code" class="level4">
<h4 class="anchored" data-anchor-id="code">Code</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co">#@title Class: Hyperspectral. { form-width: "30%" }</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> glob</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> cv2 <span class="im">as</span> cv</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> datetime <span class="im">as</span> dt</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> geographiclib.geodesic <span class="im">import</span> Geodesic</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> glob</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> google.colab.patches <span class="im">import</span> cv2_imshow <span class="co"># for image display</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pylab <span class="im">as</span> plt</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> PIL <span class="im">import</span> Image   </span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> skimage <span class="im">import</span> io</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> time</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> HyperSpec:</span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>  asof_str <span class="op">=</span> <span class="st">'HyperSpec 2021-0823-1931'</span></span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>  Fraunhofer_lines <span class="op">=</span> {</span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>                    <span class="st">'A'</span> :[ <span class="st">'O2'</span>, <span class="fl">759.370</span>  ],</span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>                    <span class="st">'B'</span> :[ <span class="st">'O2'</span>, <span class="fl">686.719</span>  ], </span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>                    <span class="st">'C'</span> :[ <span class="st">'Ha'</span>, <span class="fl">656.281</span>  ],</span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>                    <span class="st">'a'</span> :[ <span class="st">'O2'</span>, <span class="fl">627.661</span>  ],</span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>                    <span class="st">'D1'</span>:[ <span class="st">'Na'</span>, <span class="fl">589.592</span>  ],</span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a>                    <span class="st">'D2'</span>:[ <span class="st">'Na'</span>, <span class="fl">588.995</span>  ],</span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a>                    <span class="st">'D3'</span>:[ <span class="st">'He'</span>, <span class="fl">587.5618</span> ],</span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a>                  <span class="st">'e-hg'</span>:[ <span class="st">'Hg'</span>, <span class="fl">546.073</span>  ],</span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a>                    <span class="st">'E2'</span>:[ <span class="st">'Fe'</span>, <span class="fl">527.039</span>  ],</span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a>                    <span class="st">'b1'</span>:[ <span class="st">'Mg'</span>, <span class="fl">518.362</span>  ],</span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a>                    <span class="st">'b2'</span>:[ <span class="st">'Mg'</span>, <span class="fl">517.270</span>  ],</span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a>                    <span class="st">'b3'</span>:[ <span class="st">'Mg'</span>, <span class="fl">516.891</span>  ],</span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a>                    <span class="st">'b4'</span>:[ <span class="st">'Mg'</span>, <span class="fl">516.733</span>  ],</span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a>                    <span class="st">'c'</span> :[ <span class="st">'Fe'</span>, <span class="fl">495.761</span>  ],                                                            </span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a>                    <span class="st">'F'</span> :[ <span class="st">'Hb'</span>, <span class="fl">486.134</span>  ],</span>
<span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a>                    <span class="st">'d'</span> :[ <span class="st">'Fe'</span>, <span class="fl">466.814</span>  ],</span>
<span id="cb2-38"><a href="#cb2-38" aria-hidden="true" tabindex="-1"></a>                  <span class="st">'e-Fe'</span>:[ <span class="st">'Fe'</span>, <span class="fl">438.355</span>  ],</span>
<span id="cb2-39"><a href="#cb2-39" aria-hidden="true" tabindex="-1"></a>                    <span class="st">'G'</span> :[ <span class="st">'Fe'</span>, <span class="fl">430.790</span>  ],</span>
<span id="cb2-40"><a href="#cb2-40" aria-hidden="true" tabindex="-1"></a>                    <span class="st">'G2'</span>:[ <span class="st">'Ca'</span>, <span class="fl">430.774</span>  ],</span>
<span id="cb2-41"><a href="#cb2-41" aria-hidden="true" tabindex="-1"></a>                    <span class="st">'H'</span> :[ <span class="st">'Ca'</span>, <span class="fl">396.847</span>  ] </span>
<span id="cb2-42"><a href="#cb2-42" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb2-43"><a href="#cb2-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-44"><a href="#cb2-44" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Re HG_Lines.  Wavelengths taken from the following sources.</span></span>
<span id="cb2-45"><a href="#cb2-45" aria-hidden="true" tabindex="-1"></a>  <span class="co"># See: http://hyperphysics.phy-astr.gsu.edu/hbase/quantum/atspect2.html</span></span>
<span id="cb2-46"><a href="#cb2-46" aria-hidden="true" tabindex="-1"></a>  <span class="co"># and: https://commons.wikimedia.org/wiki/File:Fluorescent_lighting_spectrum_peaks_labelled.gif</span></span>
<span id="cb2-47"><a href="#cb2-47" aria-hidden="true" tabindex="-1"></a>  <span class="co"># and: https://en.wikipedia.org/wiki/Fluorescent_lamp#/media/File:Spectra-Philips_32T8_natural_sunshine_fluorescent_light.svg</span></span>
<span id="cb2-48"><a href="#cb2-48" aria-hidden="true" tabindex="-1"></a>  HG_lines <span class="op">=</span> {  </span>
<span id="cb2-49"><a href="#cb2-49" aria-hidden="true" tabindex="-1"></a>              <span class="st">'Hg-404'</span> :[ <span class="st">'Hg'</span>, <span class="fl">404.6563</span> ],</span>
<span id="cb2-50"><a href="#cb2-50" aria-hidden="true" tabindex="-1"></a>              <span class="st">'Hg-436'</span> :[ <span class="st">'Hg'</span>, <span class="fl">435.8328</span> ],</span>
<span id="cb2-51"><a href="#cb2-51" aria-hidden="true" tabindex="-1"></a>              <span class="st">'Hg-543'</span> :[ <span class="st">'Hg'</span>, <span class="fl">543.6</span>    ],</span>
<span id="cb2-52"><a href="#cb2-52" aria-hidden="true" tabindex="-1"></a>              <span class="st">'Hg-546'</span> :[ <span class="st">'Hg'</span>, <span class="fl">546.0735</span> ],</span>
<span id="cb2-53"><a href="#cb2-53" aria-hidden="true" tabindex="-1"></a>              <span class="st">'Hg-576'</span> :[ <span class="st">'Hg'</span>, <span class="fl">576.959</span>  ],</span>
<span id="cb2-54"><a href="#cb2-54" aria-hidden="true" tabindex="-1"></a>              <span class="st">'Hg-579'</span> :[ <span class="st">'Hg'</span>, <span class="fl">579.065</span>  ],</span>
<span id="cb2-55"><a href="#cb2-55" aria-hidden="true" tabindex="-1"></a>              <span class="st">'Hg-611'</span> :[ <span class="st">'Hg'</span>, <span class="fl">610.8</span>    ],</span>
<span id="cb2-56"><a href="#cb2-56" aria-hidden="true" tabindex="-1"></a>              <span class="st">'Hg-615'</span> :[ <span class="st">'Hg'</span>, <span class="fl">614.9475</span> ]</span>
<span id="cb2-57"><a href="#cb2-57" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb2-58"><a href="#cb2-58" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb2-59"><a href="#cb2-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-60"><a href="#cb2-60" aria-hidden="true" tabindex="-1"></a>  <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>):</span>
<span id="cb2-61"><a href="#cb2-61" aria-hidden="true" tabindex="-1"></a>    <span class="va">self</span>.Xpixels <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb2-62"><a href="#cb2-62" aria-hidden="true" tabindex="-1"></a>    <span class="va">self</span>.summed_rows  <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb2-63"><a href="#cb2-63" aria-hidden="true" tabindex="-1"></a>    <span class="va">self</span>.Xpixels     <span class="op">=</span> np.array(<span class="dv">1</span>)</span>
<span id="cb2-64"><a href="#cb2-64" aria-hidden="true" tabindex="-1"></a>    <span class="va">self</span>.wavelengths <span class="op">=</span> np.array(<span class="dv">1</span>)</span>
<span id="cb2-65"><a href="#cb2-65" aria-hidden="true" tabindex="-1"></a>    <span class="va">self</span>.create_time <span class="op">=</span> dt.datetime.utcnow()</span>
<span id="cb2-66"><a href="#cb2-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-67"><a href="#cb2-67" aria-hidden="true" tabindex="-1"></a>  <span class="kw">def</span> version(<span class="va">self</span>):</span>
<span id="cb2-68"><a href="#cb2-68" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> <span class="ss">f'</span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>create_time<span class="sc">}</span><span class="ss"> HyperSpec Class instantiated. asof: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>asof_str<span class="sc">}</span><span class="ss">'</span></span>
<span id="cb2-69"><a href="#cb2-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-70"><a href="#cb2-70" aria-hidden="true" tabindex="-1"></a>  <span class="kw">def</span> configure_json_spectra(<span class="va">self</span>,f):</span>
<span id="cb2-71"><a href="#cb2-71" aria-hidden="true" tabindex="-1"></a>    <span class="co">'''</span></span>
<span id="cb2-72"><a href="#cb2-72" aria-hidden="true" tabindex="-1"></a><span class="co">    Configures HabSpec internal setting according to settings within json file 'f'.</span></span>
<span id="cb2-73"><a href="#cb2-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-74"><a href="#cb2-74" aria-hidden="true" tabindex="-1"></a><span class="co">    Parameters:</span></span>
<span id="cb2-75"><a href="#cb2-75" aria-hidden="true" tabindex="-1"></a><span class="co">    -----------</span></span>
<span id="cb2-76"><a href="#cb2-76" aria-hidden="true" tabindex="-1"></a><span class="co">    f : str</span></span>
<span id="cb2-77"><a href="#cb2-77" aria-hidden="true" tabindex="-1"></a><span class="co">        HabSpec json spectra full path and file name.</span></span>
<span id="cb2-78"><a href="#cb2-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-79"><a href="#cb2-79" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns:</span></span>
<span id="cb2-80"><a href="#cb2-80" aria-hidden="true" tabindex="-1"></a><span class="co">    --------</span></span>
<span id="cb2-81"><a href="#cb2-81" aria-hidden="true" tabindex="-1"></a><span class="co">        None.</span></span>
<span id="cb2-82"><a href="#cb2-82" aria-hidden="true" tabindex="-1"></a><span class="co">    '''</span></span>
<span id="cb2-83"><a href="#cb2-83" aria-hidden="true" tabindex="-1"></a>    spec <span class="op">=</span> pd.read_json(f)                      <span class="co"># get a spectra fron a json file</span></span>
<span id="cb2-84"><a href="#cb2-84" aria-hidden="true" tabindex="-1"></a>    y <span class="op">=</span> np.array(spec[<span class="st">'hab_spec'</span>].spectra )     <span class="co"># Load the y values to an np array</span></span>
<span id="cb2-85"><a href="#cb2-85" aria-hidden="true" tabindex="-1"></a>    <span class="va">self</span>.summed_rows <span class="op">=</span> spec[<span class="st">'hab_spec'</span>].summed_rows</span>
<span id="cb2-86"><a href="#cb2-86" aria-hidden="true" tabindex="-1"></a>    <span class="va">self</span>.Xpixels <span class="op">=</span> np.arange(<span class="dv">0</span>,y.size )         <span class="co"># Construct an array of X values</span></span>
<span id="cb2-87"><a href="#cb2-87" aria-hidden="true" tabindex="-1"></a>    <span class="va">self</span>.wavelengths <span class="op">=</span> np.arange( y.size )</span>
<span id="cb2-88"><a href="#cb2-88" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> f</span>
<span id="cb2-89"><a href="#cb2-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-90"><a href="#cb2-90" aria-hidden="true" tabindex="-1"></a>  <span class="kw">def</span> calibrate_using_2_wavelengths(<span class="va">self</span>, pixel0<span class="op">=</span><span class="dv">0</span>, wavelength0<span class="op">=</span><span class="dv">0</span>, pixel1<span class="op">=</span><span class="dv">0</span>, wavelength1<span class="op">=</span><span class="dv">0</span> ):</span>
<span id="cb2-91"><a href="#cb2-91" aria-hidden="true" tabindex="-1"></a>    <span class="co">'''</span></span>
<span id="cb2-92"><a href="#cb2-92" aria-hidden="true" tabindex="-1"></a><span class="co">    Generate a Numpy array of calibration wavelenghts for each pixel. configure_json_spectra(f)</span></span>
<span id="cb2-93"><a href="#cb2-93" aria-hidden="true" tabindex="-1"></a><span class="co">    must be called beforehand inrder to set the correct number of pixels.</span></span>
<span id="cb2-94"><a href="#cb2-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-95"><a href="#cb2-95" aria-hidden="true" tabindex="-1"></a><span class="co">    Parameters:</span></span>
<span id="cb2-96"><a href="#cb2-96" aria-hidden="true" tabindex="-1"></a><span class="co">    -----------</span></span>
<span id="cb2-97"><a href="#cb2-97" aria-hidden="true" tabindex="-1"></a><span class="co">    pixel0 : int, default 0</span></span>
<span id="cb2-98"><a href="#cb2-98" aria-hidden="true" tabindex="-1"></a><span class="co">    wavelength0 : float, default 0</span></span>
<span id="cb2-99"><a href="#cb2-99" aria-hidden="true" tabindex="-1"></a><span class="co">    pixel1 : int, default 0</span></span>
<span id="cb2-100"><a href="#cb2-100" aria-hidden="true" tabindex="-1"></a><span class="co">    wavelength1 : float, default 0</span></span>
<span id="cb2-101"><a href="#cb2-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-102"><a href="#cb2-102" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns:</span></span>
<span id="cb2-103"><a href="#cb2-103" aria-hidden="true" tabindex="-1"></a><span class="co">    --------</span></span>
<span id="cb2-104"><a href="#cb2-104" aria-hidden="true" tabindex="-1"></a><span class="co">    Float array of calibrated wavelengths for each pixel.  The returned array is the</span></span>
<span id="cb2-105"><a href="#cb2-105" aria-hidden="true" tabindex="-1"></a><span class="co">    same size as self.Xpixels.</span></span>
<span id="cb2-106"><a href="#cb2-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-107"><a href="#cb2-107" aria-hidden="true" tabindex="-1"></a><span class="co">    Example:</span></span>
<span id="cb2-108"><a href="#cb2-108" aria-hidden="true" tabindex="-1"></a><span class="co">    ---------</span></span>
<span id="cb2-109"><a href="#cb2-109" aria-hidden="true" tabindex="-1"></a><span class="co">    # Configure the spectra by reading a spectra file.</span></span>
<span id="cb2-110"><a href="#cb2-110" aria-hidden="true" tabindex="-1"></a><span class="co">    fn = '/content/drive/MyDrive/Missions/2021-0717-HAB-pie/165347/hab_spectra/2021-0717-165348-272814-spec.json'</span></span>
<span id="cb2-111"><a href="#cb2-111" aria-hidden="true" tabindex="-1"></a><span class="co">    hs.configure_json_spectra(fn)</span></span>
<span id="cb2-112"><a href="#cb2-112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-113"><a href="#cb2-113" aria-hidden="true" tabindex="-1"></a><span class="co">    # Calibrate the spectra.  Pixel 73 is at 430.774nm, and pixel 941 is at 759.370nm</span></span>
<span id="cb2-114"><a href="#cb2-114" aria-hidden="true" tabindex="-1"></a><span class="co">    hs.calibrate_using_2_wavelengths(pixel0=73, wavelength0=430.774, pixel1=941, wavelength1=759.370 )</span></span>
<span id="cb2-115"><a href="#cb2-115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-116"><a href="#cb2-116" aria-hidden="true" tabindex="-1"></a><span class="co">    References:</span></span>
<span id="cb2-117"><a href="#cb2-117" aria-hidden="true" tabindex="-1"></a><span class="co">    -----------</span></span>
<span id="cb2-118"><a href="#cb2-118" aria-hidden="true" tabindex="-1"></a><span class="co">    The following are wavelength calibration sources.</span></span>
<span id="cb2-119"><a href="#cb2-119" aria-hidden="true" tabindex="-1"></a><span class="co">    See: http://hyperphysics.phy-astr.gsu.edu/hbase/quantum/atspect2.html</span></span>
<span id="cb2-120"><a href="#cb2-120" aria-hidden="true" tabindex="-1"></a><span class="co">    and: https://commons.wikimedia.org/wiki/File:Fluorescent_lighting_spectrum_peaks_labelled.gif</span></span>
<span id="cb2-121"><a href="#cb2-121" aria-hidden="true" tabindex="-1"></a><span class="co">    and: https://en.wikipedia.org/wiki/Fluorescent_lamp#/media/File:Spectra-Philips_32T8_natural_sunshine_fluorescent_light.svg</span></span>
<span id="cb2-122"><a href="#cb2-122" aria-hidden="true" tabindex="-1"></a><span class="co">    '''</span></span>
<span id="cb2-123"><a href="#cb2-123" aria-hidden="true" tabindex="-1"></a>    <span class="va">self</span>.dp <span class="op">=</span> pixel1      <span class="op">-</span> pixel0              <span class="co"># pixel delta</span></span>
<span id="cb2-124"><a href="#cb2-124" aria-hidden="true" tabindex="-1"></a>    <span class="va">self</span>.dw <span class="op">=</span> wavelength1 <span class="op">-</span> wavelength0         <span class="co"># Wavelength delta</span></span>
<span id="cb2-125"><a href="#cb2-125" aria-hidden="true" tabindex="-1"></a>    <span class="va">self</span>.slope <span class="op">=</span> <span class="va">self</span>.dw<span class="op">/</span><span class="va">self</span>.dp                <span class="co"># Linear slope</span></span>
<span id="cb2-126"><a href="#cb2-126" aria-hidden="true" tabindex="-1"></a>    <span class="va">self</span>.wavelengths <span class="op">=</span> wavelength0 <span class="op">+</span> (<span class="va">self</span>.Xpixels<span class="op">-</span>pixel0) <span class="op">*</span> <span class="va">self</span>.slope</span>
<span id="cb2-127"><a href="#cb2-127" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="va">self</span>.wavelengths</span>
<span id="cb2-128"><a href="#cb2-128" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-129"><a href="#cb2-129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-130"><a href="#cb2-130" aria-hidden="true" tabindex="-1"></a>  <span class="kw">def</span> read_spectra(<span class="va">self</span>, f, remove_bias <span class="op">=</span> <span class="va">True</span>, y_average<span class="op">=</span><span class="va">True</span> ): </span>
<span id="cb2-131"><a href="#cb2-131" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb2-132"><a href="#cb2-132" aria-hidden="true" tabindex="-1"></a><span class="co">    Reads a Json hyperspectra file.</span></span>
<span id="cb2-133"><a href="#cb2-133" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-134"><a href="#cb2-134" aria-hidden="true" tabindex="-1"></a><span class="co">    Parameters:</span></span>
<span id="cb2-135"><a href="#cb2-135" aria-hidden="true" tabindex="-1"></a><span class="co">    -----------</span></span>
<span id="cb2-136"><a href="#cb2-136" aria-hidden="true" tabindex="-1"></a><span class="co">    f : str</span></span>
<span id="cb2-137"><a href="#cb2-137" aria-hidden="true" tabindex="-1"></a><span class="co">      The full path name of a hyperspectra Json file.</span></span>
<span id="cb2-138"><a href="#cb2-138" aria-hidden="true" tabindex="-1"></a><span class="co">    remove_bias : Default True</span></span>
<span id="cb2-139"><a href="#cb2-139" aria-hidden="true" tabindex="-1"></a><span class="co">      Subtracts the minimum y value from the array of y values to remove dark current. </span></span>
<span id="cb2-140"><a href="#cb2-140" aria-hidden="true" tabindex="-1"></a><span class="co">      The minimum value will typically be found in the IR side and from the pixel </span></span>
<span id="cb2-141"><a href="#cb2-141" aria-hidden="true" tabindex="-1"></a><span class="co">      sensors that are optically obscured.</span></span>
<span id="cb2-142"><a href="#cb2-142" aria-hidden="true" tabindex="-1"></a><span class="co">    y_average : Default True</span></span>
<span id="cb2-143"><a href="#cb2-143" aria-hidden="true" tabindex="-1"></a><span class="co">      The Json values are the sum total of each pixel column. Each column contains 800</span></span>
<span id="cb2-144"><a href="#cb2-144" aria-hidden="true" tabindex="-1"></a><span class="co">      pixels. Setting this to True causes the read y values to be divided by 800.</span></span>
<span id="cb2-145"><a href="#cb2-145" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-146"><a href="#cb2-146" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns:</span></span>
<span id="cb2-147"><a href="#cb2-147" aria-hidden="true" tabindex="-1"></a><span class="co">    --------</span></span>
<span id="cb2-148"><a href="#cb2-148" aria-hidden="true" tabindex="-1"></a><span class="co">    Numpy array</span></span>
<span id="cb2-149"><a href="#cb2-149" aria-hidden="true" tabindex="-1"></a><span class="co">      An array of numpy float values representing the intensity values at each pixel. </span></span>
<span id="cb2-150"><a href="#cb2-150" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-151"><a href="#cb2-151" aria-hidden="true" tabindex="-1"></a><span class="co">    Description:</span></span>
<span id="cb2-152"><a href="#cb2-152" aria-hidden="true" tabindex="-1"></a><span class="co">    ------------</span></span>
<span id="cb2-153"><a href="#cb2-153" aria-hidden="true" tabindex="-1"></a><span class="co">    Reads a Json spectra from a file.</span></span>
<span id="cb2-154"><a href="#cb2-154" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-155"><a href="#cb2-155" aria-hidden="true" tabindex="-1"></a><span class="co">    Examples:</span></span>
<span id="cb2-156"><a href="#cb2-156" aria-hidden="true" tabindex="-1"></a><span class="co">    ---------</span></span>
<span id="cb2-157"><a href="#cb2-157" aria-hidden="true" tabindex="-1"></a><span class="co">    fn = '/content/drive/MyDrive/Missions/2021-0717-HAB-pie/165347/hab_spectra/2021-0717-165348-272814-spec.json'</span></span>
<span id="cb2-158"><a href="#cb2-158" aria-hidden="true" tabindex="-1"></a><span class="co">    s = hs.read_spectra(fn)</span></span>
<span id="cb2-159"><a href="#cb2-159" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb2-160"><a href="#cb2-160" aria-hidden="true" tabindex="-1"></a>    spec <span class="op">=</span> pd.read_json(f)</span>
<span id="cb2-161"><a href="#cb2-161" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="va">self</span>.summed_rows <span class="op">==</span> <span class="dv">0</span> :</span>
<span id="cb2-162"><a href="#cb2-162" aria-hidden="true" tabindex="-1"></a>      <span class="va">self</span>.configure_json_spectra(f)</span>
<span id="cb2-163"><a href="#cb2-163" aria-hidden="true" tabindex="-1"></a>    y <span class="op">=</span> np.array(spec[<span class="st">'hab_spec'</span>].spectra)</span>
<span id="cb2-164"><a href="#cb2-164" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-165"><a href="#cb2-165" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> y_average <span class="op">==</span> <span class="va">True</span>:</span>
<span id="cb2-166"><a href="#cb2-166" aria-hidden="true" tabindex="-1"></a>      y <span class="op">=</span> y <span class="op">/</span> <span class="va">self</span>.summed_rows</span>
<span id="cb2-167"><a href="#cb2-167" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-168"><a href="#cb2-168" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> remove_bias <span class="op">==</span> <span class="va">True</span>:</span>
<span id="cb2-169"><a href="#cb2-169" aria-hidden="true" tabindex="-1"></a>      y <span class="op">=</span> y <span class="op">-</span> y.<span class="bu">min</span>()</span>
<span id="cb2-170"><a href="#cb2-170" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> y</span>
<span id="cb2-171"><a href="#cb2-171" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-172"><a href="#cb2-172" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-173"><a href="#cb2-173" aria-hidden="true" tabindex="-1"></a>  <span class="co">'''</span></span>
<span id="cb2-174"><a href="#cb2-174" aria-hidden="true" tabindex="-1"></a><span class="co">    Typical filename.</span></span>
<span id="cb2-175"><a href="#cb2-175" aria-hidden="true" tabindex="-1"></a><span class="co">      '/content/drive/MyDrive/Missions/2021-0717-HAB-pie/141625/hab_spectra/2021-0717-141658-955482-spec.json'</span></span>
<span id="cb2-176"><a href="#cb2-176" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-177"><a href="#cb2-177" aria-hidden="true" tabindex="-1"></a><span class="co">  '''</span></span>
<span id="cb2-178"><a href="#cb2-178" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-179"><a href="#cb2-179" aria-hidden="true" tabindex="-1"></a>  <span class="kw">def</span> hhmmss_to_sod(<span class="va">self</span>, hhmmss, Usecs<span class="op">=</span><span class="dv">0</span>):</span>
<span id="cb2-180"><a href="#cb2-180" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb2-181"><a href="#cb2-181" aria-hidden="true" tabindex="-1"></a><span class="co">    Converts a time string in 'HHMMSS' format to a seconds-of-the-day</span></span>
<span id="cb2-182"><a href="#cb2-182" aria-hidden="true" tabindex="-1"></a><span class="co">    including an optional microseconds fraction.</span></span>
<span id="cb2-183"><a href="#cb2-183" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-184"><a href="#cb2-184" aria-hidden="true" tabindex="-1"></a><span class="co">    Parameters:</span></span>
<span id="cb2-185"><a href="#cb2-185" aria-hidden="true" tabindex="-1"></a><span class="co">    ----------- </span></span>
<span id="cb2-186"><a href="#cb2-186" aria-hidden="true" tabindex="-1"></a><span class="co">    hhmmss : str</span></span>
<span id="cb2-187"><a href="#cb2-187" aria-hidden="true" tabindex="-1"></a><span class="co">    Usecs  : str, default=0</span></span>
<span id="cb2-188"><a href="#cb2-188" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-189"><a href="#cb2-189" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns: </span></span>
<span id="cb2-190"><a href="#cb2-190" aria-hidden="true" tabindex="-1"></a><span class="co">    --------</span></span>
<span id="cb2-191"><a href="#cb2-191" aria-hidden="true" tabindex="-1"></a><span class="co">    float</span></span>
<span id="cb2-192"><a href="#cb2-192" aria-hidden="true" tabindex="-1"></a><span class="co">      Seconds of the day including the fractional part computed from `Usecs`</span></span>
<span id="cb2-193"><a href="#cb2-193" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb2-194"><a href="#cb2-194" aria-hidden="true" tabindex="-1"></a><span class="co">    Description:</span></span>
<span id="cb2-195"><a href="#cb2-195" aria-hidden="true" tabindex="-1"></a><span class="co">    ------------</span></span>
<span id="cb2-196"><a href="#cb2-196" aria-hidden="true" tabindex="-1"></a><span class="co">    hhmmss where hh is hours, mm is minutes, and ss is seconds. Example '123456'</span></span>
<span id="cb2-197"><a href="#cb2-197" aria-hidden="true" tabindex="-1"></a><span class="co">    is 12 hours, 34 minutes, and 56 seconds. A string representing the number of</span></span>
<span id="cb2-198"><a href="#cb2-198" aria-hidden="true" tabindex="-1"></a><span class="co">    microseconds since the last second increment, ie the fractional part of a second. </span></span>
<span id="cb2-199"><a href="#cb2-199" aria-hidden="true" tabindex="-1"></a><span class="co">    Example: '954561' represents 0.954561 seconds, or 954,561 microseconds since the</span></span>
<span id="cb2-200"><a href="#cb2-200" aria-hidden="true" tabindex="-1"></a><span class="co">    last seconds rollover. Returns A single floating point value of the seconds since</span></span>
<span id="cb2-201"><a href="#cb2-201" aria-hidden="true" tabindex="-1"></a><span class="co">    midnight plus the fractional seconds.</span></span>
<span id="cb2-202"><a href="#cb2-202" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-203"><a href="#cb2-203" aria-hidden="true" tabindex="-1"></a><span class="co">    Examples:</span></span>
<span id="cb2-204"><a href="#cb2-204" aria-hidden="true" tabindex="-1"></a><span class="co">    ---------</span></span>
<span id="cb2-205"><a href="#cb2-205" aria-hidden="true" tabindex="-1"></a><span class="co">    To be added.</span></span>
<span id="cb2-206"><a href="#cb2-206" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-207"><a href="#cb2-207" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb2-208"><a href="#cb2-208" aria-hidden="true" tabindex="-1"></a>    hh <span class="op">=</span> <span class="bu">int</span>(hhmmss[<span class="dv">0</span>:<span class="dv">2</span>])</span>
<span id="cb2-209"><a href="#cb2-209" aria-hidden="true" tabindex="-1"></a>    mm <span class="op">=</span> <span class="bu">int</span>(hhmmss[<span class="dv">2</span>:<span class="dv">4</span>])</span>
<span id="cb2-210"><a href="#cb2-210" aria-hidden="true" tabindex="-1"></a>    ss <span class="op">=</span> <span class="bu">int</span>(hhmmss[<span class="dv">4</span>:<span class="dv">6</span>])</span>
<span id="cb2-211"><a href="#cb2-211" aria-hidden="true" tabindex="-1"></a>    fsod <span class="op">=</span> hh<span class="op">*</span><span class="dv">3600</span> <span class="op">+</span> mm<span class="op">*</span><span class="dv">60</span> <span class="op">+</span> ss <span class="op">+</span> <span class="bu">float</span>(Usecs) <span class="op">*</span> <span class="fl">1e-6</span></span>
<span id="cb2-212"><a href="#cb2-212" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> fsod</span>
<span id="cb2-213"><a href="#cb2-213" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-214"><a href="#cb2-214" aria-hidden="true" tabindex="-1"></a>  <span class="co">#debug_nearest_rgb_image = False</span></span>
<span id="cb2-215"><a href="#cb2-215" aria-hidden="true" tabindex="-1"></a>  <span class="kw">def</span> nearest_rgb_image(<span class="va">self</span>, fn, debug<span class="op">=</span><span class="va">False</span>):</span>
<span id="cb2-216"><a href="#cb2-216" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb2-217"><a href="#cb2-217" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns the path/filename to the RGB photo closes in time to `fn`.  `fn` is the</span></span>
<span id="cb2-218"><a href="#cb2-218" aria-hidden="true" tabindex="-1"></a><span class="co">    filename of a Json hyperspectral file.</span></span>
<span id="cb2-219"><a href="#cb2-219" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-220"><a href="#cb2-220" aria-hidden="true" tabindex="-1"></a><span class="co">    Parameters:</span></span>
<span id="cb2-221"><a href="#cb2-221" aria-hidden="true" tabindex="-1"></a><span class="co">    -----------</span></span>
<span id="cb2-222"><a href="#cb2-222" aria-hidden="true" tabindex="-1"></a><span class="co">    fn : str</span></span>
<span id="cb2-223"><a href="#cb2-223" aria-hidden="true" tabindex="-1"></a><span class="co">      Full path/filename of a hyperspectral Json file.</span></span>
<span id="cb2-224"><a href="#cb2-224" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-225"><a href="#cb2-225" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns:</span></span>
<span id="cb2-226"><a href="#cb2-226" aria-hidden="true" tabindex="-1"></a><span class="co">    --------</span></span>
<span id="cb2-227"><a href="#cb2-227" aria-hidden="true" tabindex="-1"></a><span class="co">    str</span></span>
<span id="cb2-228"><a href="#cb2-228" aria-hidden="true" tabindex="-1"></a><span class="co">      A string path/filename of the closes RGB photo.</span></span>
<span id="cb2-229"><a href="#cb2-229" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-230"><a href="#cb2-230" aria-hidden="true" tabindex="-1"></a><span class="co">    Examples:</span></span>
<span id="cb2-231"><a href="#cb2-231" aria-hidden="true" tabindex="-1"></a><span class="co">    ---------</span></span>
<span id="cb2-232"><a href="#cb2-232" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-233"><a href="#cb2-233" aria-hidden="true" tabindex="-1"></a><span class="co">    References:</span></span>
<span id="cb2-234"><a href="#cb2-234" aria-hidden="true" tabindex="-1"></a><span class="co">    -----------</span></span>
<span id="cb2-235"><a href="#cb2-235" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb2-236"><a href="#cb2-236" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> debug:</span>
<span id="cb2-237"><a href="#cb2-237" aria-hidden="true" tabindex="-1"></a>      <span class="bu">print</span>(<span class="ss">f'debug_nearest_rgb_image(fn): fn=</span><span class="sc">{</span>fn<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb2-238"><a href="#cb2-238" aria-hidden="true" tabindex="-1"></a>    fn_parts <span class="op">=</span> fn.split(<span class="st">'/'</span>)   <span class="co"># Split path by '/'</span></span>
<span id="cb2-239"><a href="#cb2-239" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> debug:</span>
<span id="cb2-240"><a href="#cb2-240" aria-hidden="true" tabindex="-1"></a>      <span class="bu">print</span>(<span class="ss">f'debug_nearest_rgb_image(fn): fn_parts=</span><span class="sc">{</span>fn_parts<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb2-241"><a href="#cb2-241" aria-hidden="true" tabindex="-1"></a>    rgb_p <span class="op">=</span> fn_parts                          <span class="co"># Make a copy to build the rgb path/filename in.</span></span>
<span id="cb2-242"><a href="#cb2-242" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> debug:</span>
<span id="cb2-243"><a href="#cb2-243" aria-hidden="true" tabindex="-1"></a>      <span class="bu">print</span>(<span class="ss">f'debug_nearest_rgb_image(fn): rgb_p=</span><span class="sc">{</span>rgb_p<span class="sc">}</span><span class="ss">'</span>)    </span>
<span id="cb2-244"><a href="#cb2-244" aria-hidden="true" tabindex="-1"></a>    rgb_p[<span class="op">-</span><span class="dv">2</span>] <span class="op">=</span> <span class="st">'hab_rgb'</span>                     <span class="co"># Change the subdir to point to hab_rgb</span></span>
<span id="cb2-245"><a href="#cb2-245" aria-hidden="true" tabindex="-1"></a>    rgb_fn <span class="op">=</span> rgb_p[<span class="op">-</span><span class="dv">1</span>].split(<span class="st">'-'</span>)             <span class="co"># Split the filename by '-' to access parts.</span></span>
<span id="cb2-246"><a href="#cb2-246" aria-hidden="true" tabindex="-1"></a>    rgb_fn[<span class="op">-</span><span class="dv">2</span>] <span class="op">=</span> <span class="st">'*'</span>                          <span class="co"># Replace the microseconds with '*' wildcard.</span></span>
<span id="cb2-247"><a href="#cb2-247" aria-hidden="true" tabindex="-1"></a>    rgb_fn[<span class="op">-</span><span class="dv">1</span>] <span class="op">=</span> <span class="st">'rgb.jpg'</span>                    <span class="co"># Change the file tail to rgb.jpg</span></span>
<span id="cb2-248"><a href="#cb2-248" aria-hidden="true" tabindex="-1"></a>    rgb_p[<span class="op">-</span><span class="dv">1</span>] <span class="op">=</span> <span class="st">'-'</span>.join(rgb_fn)              <span class="co"># Glue the name back together</span></span>
<span id="cb2-249"><a href="#cb2-249" aria-hidden="true" tabindex="-1"></a>    rgb_p2 <span class="op">=</span> <span class="st">'/'</span>.join(rgb_p)                  <span class="co"># Now glue the whole path back together</span></span>
<span id="cb2-250"><a href="#cb2-250" aria-hidden="true" tabindex="-1"></a>    rv <span class="op">=</span> glob.glob(rgb_p2)[<span class="dv">0</span>]                 <span class="co"># Return the first entry incase there are more than 1.</span></span>
<span id="cb2-251"><a href="#cb2-251" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> debug:</span>
<span id="cb2-252"><a href="#cb2-252" aria-hidden="true" tabindex="-1"></a>      <span class="bu">print</span>(<span class="ss">f'debug_nearest_rgb_image(fn): rv=</span><span class="sc">{</span>rv<span class="sc">}</span><span class="ss">'</span>) </span>
<span id="cb2-253"><a href="#cb2-253" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> rv</span>
<span id="cb2-254"><a href="#cb2-254" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-255"><a href="#cb2-255" aria-hidden="true" tabindex="-1"></a>  <span class="co">#=================================================================================</span></span>
<span id="cb2-256"><a href="#cb2-256" aria-hidden="true" tabindex="-1"></a>  <span class="kw">def</span> get_list_of_json_spectra(<span class="va">self</span>, p):</span>
<span id="cb2-257"><a href="#cb2-257" aria-hidden="true" tabindex="-1"></a>    <span class="co">''' Returns a list of Json spectra full path filenames found in subdirs under "p". '''</span></span>
<span id="cb2-258"><a href="#cb2-258" aria-hidden="true" tabindex="-1"></a>    gstr <span class="op">=</span> <span class="ss">f'</span><span class="sc">{</span>p<span class="sc">}</span><span class="ss">/*/*/*-spec.json'</span></span>
<span id="cb2-259"><a href="#cb2-259" aria-hidden="true" tabindex="-1"></a>    lst <span class="op">=</span> glob.glob(gstr, recursive<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb2-260"><a href="#cb2-260" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> lst</span>
<span id="cb2-261"><a href="#cb2-261" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-262"><a href="#cb2-262" aria-hidden="true" tabindex="-1"></a>  <span class="co">#=================================================================================</span></span>
<span id="cb2-263"><a href="#cb2-263" aria-hidden="true" tabindex="-1"></a>  <span class="kw">def</span> extract_hms(<span class="va">self</span>, fn):</span>
<span id="cb2-264"><a href="#cb2-264" aria-hidden="true" tabindex="-1"></a>    <span class="co">'''Extract the HHMMSS and Fsecs strings from filename "fn"</span></span>
<span id="cb2-265"><a href="#cb2-265" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-266"><a href="#cb2-266" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns:</span></span>
<span id="cb2-267"><a href="#cb2-267" aria-hidden="true" tabindex="-1"></a><span class="co">    --------</span></span>
<span id="cb2-268"><a href="#cb2-268" aria-hidden="true" tabindex="-1"></a><span class="co">    ( hhmmss:str, fsecs:str, hhmmss.fsecs:float, sod.fsecs:float )</span></span>
<span id="cb2-269"><a href="#cb2-269" aria-hidden="true" tabindex="-1"></a><span class="co">    '''</span></span>
<span id="cb2-270"><a href="#cb2-270" aria-hidden="true" tabindex="-1"></a>    lst <span class="op">=</span> fn.split(<span class="st">'-'</span>)</span>
<span id="cb2-271"><a href="#cb2-271" aria-hidden="true" tabindex="-1"></a>    sod <span class="op">=</span> <span class="va">self</span>.hhmmss_to_sod( lst[<span class="op">-</span><span class="dv">3</span>], Usecs<span class="op">=</span>lst[<span class="op">-</span><span class="dv">2</span>] )</span>
<span id="cb2-272"><a href="#cb2-272" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> ( lst[<span class="op">-</span><span class="dv">3</span>], lst[<span class="op">-</span><span class="dv">2</span>], <span class="bu">float</span>(lst[<span class="op">-</span><span class="dv">3</span>])<span class="op">+</span><span class="bu">float</span>(lst[<span class="op">-</span><span class="dv">2</span>])<span class="op">*</span><span class="fl">1e-6</span>, sod  )</span>
<span id="cb2-273"><a href="#cb2-273" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-274"><a href="#cb2-274" aria-hidden="true" tabindex="-1"></a>  <span class="co">#=================================================================================</span></span>
<span id="cb2-275"><a href="#cb2-275" aria-hidden="true" tabindex="-1"></a>  <span class="kw">def</span> json_specs_to_df(<span class="va">self</span>, specs ):</span>
<span id="cb2-276"><a href="#cb2-276" aria-hidden="true" tabindex="-1"></a>    <span class="co">'''</span></span>
<span id="cb2-277"><a href="#cb2-277" aria-hidden="true" tabindex="-1"></a><span class="co">    Extracts the hhmmss and fsecs from 'specs' filename, converts</span></span>
<span id="cb2-278"><a href="#cb2-278" aria-hidden="true" tabindex="-1"></a><span class="co">    the hhmmss and fsecs strings to float SOD.fsecs.</span></span>
<span id="cb2-279"><a href="#cb2-279" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-280"><a href="#cb2-280" aria-hidden="true" tabindex="-1"></a><span class="co">    Parameters:</span></span>
<span id="cb2-281"><a href="#cb2-281" aria-hidden="true" tabindex="-1"></a><span class="co">    specs: list  A list of json spectra files.</span></span>
<span id="cb2-282"><a href="#cb2-282" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-283"><a href="#cb2-283" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns:</span></span>
<span id="cb2-284"><a href="#cb2-284" aria-hidden="true" tabindex="-1"></a><span class="co">    --------</span></span>
<span id="cb2-285"><a href="#cb2-285" aria-hidden="true" tabindex="-1"></a><span class="co">    A DataFrame of sod.fsecs:float, hhmmss:str, Json_spec:str</span></span>
<span id="cb2-286"><a href="#cb2-286" aria-hidden="true" tabindex="-1"></a><span class="co">    '''</span></span>
<span id="cb2-287"><a href="#cb2-287" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract the hhmmss and fsecs from each file name,</span></span>
<span id="cb2-288"><a href="#cb2-288" aria-hidden="true" tabindex="-1"></a>    <span class="co"># convert the hhmmss and fsecs to float SOD.fsecs, </span></span>
<span id="cb2-289"><a href="#cb2-289" aria-hidden="true" tabindex="-1"></a>    <span class="co"># and create a list of each.</span></span>
<span id="cb2-290"><a href="#cb2-290" aria-hidden="true" tabindex="-1"></a>    hhmmss <span class="op">=</span> []</span>
<span id="cb2-291"><a href="#cb2-291" aria-hidden="true" tabindex="-1"></a>    fsecs  <span class="op">=</span> []</span>
<span id="cb2-292"><a href="#cb2-292" aria-hidden="true" tabindex="-1"></a>    sod    <span class="op">=</span> []</span>
<span id="cb2-293"><a href="#cb2-293" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> v <span class="kw">in</span> specs:</span>
<span id="cb2-294"><a href="#cb2-294" aria-hidden="true" tabindex="-1"></a>      tx <span class="op">=</span> <span class="va">self</span>.extract_hms( v )</span>
<span id="cb2-295"><a href="#cb2-295" aria-hidden="true" tabindex="-1"></a>      hhmmss.append( tx[<span class="dv">0</span>] )   <span class="co"># Build the list if hhmmss strings.</span></span>
<span id="cb2-296"><a href="#cb2-296" aria-hidden="true" tabindex="-1"></a>      sod.append( tx[<span class="dv">3</span>] )      <span class="co"># Build the list of sod floats.</span></span>
<span id="cb2-297"><a href="#cb2-297" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-298"><a href="#cb2-298" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Now convert the  lists to a Pandas dataframe.</span></span>
<span id="cb2-299"><a href="#cb2-299" aria-hidden="true" tabindex="-1"></a>    dct <span class="op">=</span> {<span class="st">'sod'</span>:sod, <span class="st">'hhmmss'</span>:hhmmss, <span class="st">'Json_spec'</span>:specs}</span>
<span id="cb2-300"><a href="#cb2-300" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> pd.DataFrame( dct )</span>
<span id="cb2-301"><a href="#cb2-301" aria-hidden="true" tabindex="-1"></a>    df.sort_values(by<span class="op">=</span>[<span class="st">'sod'</span>], inplace<span class="op">=</span><span class="va">True</span>)              <span class="co"># Sort the data in time order.</span></span>
<span id="cb2-302"><a href="#cb2-302" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> df</span>
<span id="cb2-303"><a href="#cb2-303" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-304"><a href="#cb2-304" aria-hidden="true" tabindex="-1"></a>  <span class="co">#=================================================================================</span></span>
<span id="cb2-305"><a href="#cb2-305" aria-hidden="true" tabindex="-1"></a>  <span class="co">#debug_read_gps_file_to_df = False</span></span>
<span id="cb2-306"><a href="#cb2-306" aria-hidden="true" tabindex="-1"></a>  <span class="kw">def</span> read_gps_file_to_df(<span class="va">self</span>, ifn, debug<span class="op">=</span><span class="va">False</span>):</span>
<span id="cb2-307"><a href="#cb2-307" aria-hidden="true" tabindex="-1"></a>    <span class="co">'''</span></span>
<span id="cb2-308"><a href="#cb2-308" aria-hidden="true" tabindex="-1"></a><span class="co">    Read a GPS datafile into a dataframe and convert the HH:MM:SS</span></span>
<span id="cb2-309"><a href="#cb2-309" aria-hidden="true" tabindex="-1"></a><span class="co">    to add an SOD column.</span></span>
<span id="cb2-310"><a href="#cb2-310" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-311"><a href="#cb2-311" aria-hidden="true" tabindex="-1"></a><span class="co">    Parameters:</span></span>
<span id="cb2-312"><a href="#cb2-312" aria-hidden="true" tabindex="-1"></a><span class="co">    -----------</span></span>
<span id="cb2-313"><a href="#cb2-313" aria-hidden="true" tabindex="-1"></a><span class="co">    ifn : str</span></span>
<span id="cb2-314"><a href="#cb2-314" aria-hidden="true" tabindex="-1"></a><span class="co">        Input GPS datafile full path name</span></span>
<span id="cb2-315"><a href="#cb2-315" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-316"><a href="#cb2-316" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns:</span></span>
<span id="cb2-317"><a href="#cb2-317" aria-hidden="true" tabindex="-1"></a><span class="co">    --------</span></span>
<span id="cb2-318"><a href="#cb2-318" aria-hidden="true" tabindex="-1"></a><span class="co">    Pandas Dataframe of the GPS data.</span></span>
<span id="cb2-319"><a href="#cb2-319" aria-hidden="true" tabindex="-1"></a><span class="co">    '''</span></span>
<span id="cb2-320"><a href="#cb2-320" aria-hidden="true" tabindex="-1"></a>    gps_df <span class="op">=</span> pd.read_csv(ifn, sep<span class="op">=</span><span class="st">'\s+'</span>, comment<span class="op">=</span><span class="st">'#'</span>)</span>
<span id="cb2-321"><a href="#cb2-321" aria-hidden="true" tabindex="-1"></a>    gps_df.sort_values(by<span class="op">=</span>[<span class="st">'HMS'</span>], inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb2-322"><a href="#cb2-322" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Convert the ASCII HH:MM:SS from the GPS to seconds of the day (SOD) and</span></span>
<span id="cb2-323"><a href="#cb2-323" aria-hidden="true" tabindex="-1"></a>    <span class="co"># add an 'SOD' column to the gps dataframe.</span></span>
<span id="cb2-324"><a href="#cb2-324" aria-hidden="true" tabindex="-1"></a>    sod_lst <span class="op">=</span> []</span>
<span id="cb2-325"><a href="#cb2-325" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> t <span class="kw">in</span> gps_df[<span class="st">'HMS'</span>]:</span>
<span id="cb2-326"><a href="#cb2-326" aria-hidden="true" tabindex="-1"></a>      sod_lst.append( <span class="va">self</span>.hms2sod(t))</span>
<span id="cb2-327"><a href="#cb2-327" aria-hidden="true" tabindex="-1"></a>    gps_df[<span class="st">'SOD'</span>] <span class="op">=</span> sod_lst</span>
<span id="cb2-328"><a href="#cb2-328" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-329"><a href="#cb2-329" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Compute, and add 'Course' to dataframe</span></span>
<span id="cb2-330"><a href="#cb2-330" aria-hidden="true" tabindex="-1"></a>    course <span class="op">=</span> []</span>
<span id="cb2-331"><a href="#cb2-331" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span>  <span class="bu">range</span>(<span class="bu">len</span>(gps_df)<span class="op">-</span><span class="dv">1</span>):</span>
<span id="cb2-332"><a href="#cb2-332" aria-hidden="true" tabindex="-1"></a>      course.append ( <span class="va">self</span>.get_bearing( </span>
<span id="cb2-333"><a href="#cb2-333" aria-hidden="true" tabindex="-1"></a>          lat1<span class="op">=</span>gps_df[<span class="st">'Lat'</span>].iloc[i], long1<span class="op">=</span>gps_df[<span class="st">'Lon'</span>].iloc[i], </span>
<span id="cb2-334"><a href="#cb2-334" aria-hidden="true" tabindex="-1"></a>          lat2<span class="op">=</span>gps_df[<span class="st">'Lat'</span>].iloc[i<span class="op">+</span><span class="dv">1</span>], long2<span class="op">=</span>gps_df[<span class="st">'Lon'</span>].iloc[i<span class="op">+</span><span class="dv">1</span>] </span>
<span id="cb2-335"><a href="#cb2-335" aria-hidden="true" tabindex="-1"></a>          ) </span>
<span id="cb2-336"><a href="#cb2-336" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb2-337"><a href="#cb2-337" aria-hidden="true" tabindex="-1"></a>    course.append( <span class="fl">0.0</span> )      <span class="co"># To make the same length</span></span>
<span id="cb2-338"><a href="#cb2-338" aria-hidden="true" tabindex="-1"></a>    gps_df[<span class="st">'Course'</span>] <span class="op">=</span> course</span>
<span id="cb2-339"><a href="#cb2-339" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> gps_df</span>
<span id="cb2-340"><a href="#cb2-340" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-341"><a href="#cb2-341" aria-hidden="true" tabindex="-1"></a>  <span class="co">#=================================================================================</span></span>
<span id="cb2-342"><a href="#cb2-342" aria-hidden="true" tabindex="-1"></a>  <span class="co"># See: https://numpy.org/doc/stable/reference/generated/numpy.interp.html</span></span>
<span id="cb2-343"><a href="#cb2-343" aria-hidden="true" tabindex="-1"></a>  <span class="co">#debug_compute_gps_positions = False</span></span>
<span id="cb2-344"><a href="#cb2-344" aria-hidden="true" tabindex="-1"></a>  <span class="kw">def</span> compute_gps_positions( <span class="va">self</span>, gps, spec_df, debug<span class="op">=</span><span class="va">False</span>):</span>
<span id="cb2-345"><a href="#cb2-345" aria-hidden="true" tabindex="-1"></a>    <span class="co">'''</span></span>
<span id="cb2-346"><a href="#cb2-346" aria-hidden="true" tabindex="-1"></a><span class="co">    Interpolates spectra positions from gps.</span></span>
<span id="cb2-347"><a href="#cb2-347" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-348"><a href="#cb2-348" aria-hidden="true" tabindex="-1"></a><span class="co">    Parameters:</span></span>
<span id="cb2-349"><a href="#cb2-349" aria-hidden="true" tabindex="-1"></a><span class="co">    -----------</span></span>
<span id="cb2-350"><a href="#cb2-350" aria-hidden="true" tabindex="-1"></a><span class="co">    gps : dataframe</span></span>
<span id="cb2-351"><a href="#cb2-351" aria-hidden="true" tabindex="-1"></a><span class="co">        A dataframe of overlapping gps position data.</span></span>
<span id="cb2-352"><a href="#cb2-352" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-353"><a href="#cb2-353" aria-hidden="true" tabindex="-1"></a><span class="co">    spec_df : dataframe</span></span>
<span id="cb2-354"><a href="#cb2-354" aria-hidden="true" tabindex="-1"></a><span class="co">        A dataframe of values vs time from the spectrometer.</span></span>
<span id="cb2-355"><a href="#cb2-355" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-356"><a href="#cb2-356" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns:</span></span>
<span id="cb2-357"><a href="#cb2-357" aria-hidden="true" tabindex="-1"></a><span class="co">    --------</span></span>
<span id="cb2-358"><a href="#cb2-358" aria-hidden="true" tabindex="-1"></a><span class="co">    See: https://numpy.org/doc/stable/reference/generated/numpy.interp.html</span></span>
<span id="cb2-359"><a href="#cb2-359" aria-hidden="true" tabindex="-1"></a><span class="co">    '''</span></span>
<span id="cb2-360"><a href="#cb2-360" aria-hidden="true" tabindex="-1"></a>    spec_df[<span class="st">'Lat'</span>]    <span class="op">=</span> np.interp(spec_df[<span class="st">'sod'</span>], gps[<span class="st">'SOD'</span>], gps[<span class="st">'Lat'</span>])</span>
<span id="cb2-361"><a href="#cb2-361" aria-hidden="true" tabindex="-1"></a>    spec_df[<span class="st">'Lon'</span>]    <span class="op">=</span> np.interp(spec_df[<span class="st">'sod'</span>], gps[<span class="st">'SOD'</span>], gps[<span class="st">'Lon'</span>])</span>
<span id="cb2-362"><a href="#cb2-362" aria-hidden="true" tabindex="-1"></a>    spec_df[<span class="st">'Elev'</span>]   <span class="op">=</span> np.interp(spec_df[<span class="st">'sod'</span>], gps[<span class="st">'SOD'</span>], gps[<span class="st">'Elev'</span>])</span>
<span id="cb2-363"><a href="#cb2-363" aria-hidden="true" tabindex="-1"></a>    spec_df[<span class="st">'Course'</span>] <span class="op">=</span> np.interp(spec_df[<span class="st">'sod'</span>], gps[<span class="st">'SOD'</span>], gps[<span class="st">'Course'</span>])</span>
<span id="cb2-364"><a href="#cb2-364" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> spec_df</span>
<span id="cb2-365"><a href="#cb2-365" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-366"><a href="#cb2-366" aria-hidden="true" tabindex="-1"></a>  <span class="co">#@title Get bearing between two lat/lon pairs { form-width: "30%" }</span></span>
<span id="cb2-367"><a href="#cb2-367" aria-hidden="true" tabindex="-1"></a>  <span class="co">#=================================================================================</span></span>
<span id="cb2-368"><a href="#cb2-368" aria-hidden="true" tabindex="-1"></a>  <span class="co">#debug_get_bearing = False</span></span>
<span id="cb2-369"><a href="#cb2-369" aria-hidden="true" tabindex="-1"></a>  <span class="kw">def</span> get_bearing(<span class="va">self</span>, lat1<span class="op">=</span><span class="dv">0</span>, lat2<span class="op">=</span><span class="dv">0</span>, long1<span class="op">=</span><span class="dv">0</span>, long2<span class="op">=</span><span class="dv">0</span>, debug<span class="op">=</span><span class="va">False</span>):</span>
<span id="cb2-370"><a href="#cb2-370" aria-hidden="true" tabindex="-1"></a>    <span class="co">'''</span></span>
<span id="cb2-371"><a href="#cb2-371" aria-hidden="true" tabindex="-1"></a><span class="co">    Comutes and returns the bearing between two lat/lon pairs.</span></span>
<span id="cb2-372"><a href="#cb2-372" aria-hidden="true" tabindex="-1"></a><span class="co">    See:</span></span>
<span id="cb2-373"><a href="#cb2-373" aria-hidden="true" tabindex="-1"></a><span class="co">        http://shorturl.at/atGHN</span></span>
<span id="cb2-374"><a href="#cb2-374" aria-hidden="true" tabindex="-1"></a><span class="co">    '''</span></span>
<span id="cb2-375"><a href="#cb2-375" aria-hidden="true" tabindex="-1"></a>    brng <span class="op">=</span> Geodesic.WGS84.Inverse(lat1, long1, lat2, long2)[<span class="st">'azi1'</span>]</span>
<span id="cb2-376"><a href="#cb2-376" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> brng</span>
<span id="cb2-377"><a href="#cb2-377" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-378"><a href="#cb2-378" aria-hidden="true" tabindex="-1"></a>  <span class="co">#=================================================================================</span></span>
<span id="cb2-379"><a href="#cb2-379" aria-hidden="true" tabindex="-1"></a>  <span class="co">#debug_hms2sod = False</span></span>
<span id="cb2-380"><a href="#cb2-380" aria-hidden="true" tabindex="-1"></a>  <span class="kw">def</span> hms2sod(<span class="va">self</span>, <span class="bu">str</span>, debug<span class="op">=</span><span class="va">False</span>):</span>
<span id="cb2-381"><a href="#cb2-381" aria-hidden="true" tabindex="-1"></a>    <span class="co">'''</span></span>
<span id="cb2-382"><a href="#cb2-382" aria-hidden="true" tabindex="-1"></a><span class="co">    Converts an ASCII string in the form 'HH:MM"SS' to seconds of the day. Works with</span></span>
<span id="cb2-383"><a href="#cb2-383" aria-hidden="true" tabindex="-1"></a><span class="co">    fractional seconds.</span></span>
<span id="cb2-384"><a href="#cb2-384" aria-hidden="true" tabindex="-1"></a><span class="co">    '''</span></span>
<span id="cb2-385"><a href="#cb2-385" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(<span class="bu">str</span>) <span class="op">==</span> <span class="dv">8</span>:</span>
<span id="cb2-386"><a href="#cb2-386" aria-hidden="true" tabindex="-1"></a>      ts <span class="op">=</span> time.strptime( <span class="bu">str</span>, <span class="st">'%H:%M:%S'</span>)</span>
<span id="cb2-387"><a href="#cb2-387" aria-hidden="true" tabindex="-1"></a>      fs <span class="op">=</span> <span class="fl">0.0</span></span>
<span id="cb2-388"><a href="#cb2-388" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb2-389"><a href="#cb2-389" aria-hidden="true" tabindex="-1"></a>      ts <span class="op">=</span> time.strptime( <span class="bu">str</span>[<span class="dv">0</span>:<span class="dv">8</span>], <span class="st">'%H:%M:%S'</span>)</span>
<span id="cb2-390"><a href="#cb2-390" aria-hidden="true" tabindex="-1"></a>      fs <span class="op">=</span> <span class="bu">float</span>(<span class="bu">str</span>[<span class="dv">8</span>:])</span>
<span id="cb2-391"><a href="#cb2-391" aria-hidden="true" tabindex="-1"></a>    sod <span class="op">=</span> ts[<span class="dv">3</span>]<span class="op">*</span><span class="dv">3600</span> <span class="op">+</span> ts[<span class="dv">4</span>]<span class="op">*</span><span class="dv">60</span> <span class="op">+</span> ts[<span class="dv">5</span>] <span class="op">+</span> fs</span>
<span id="cb2-392"><a href="#cb2-392" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> sod</span>
<span id="cb2-393"><a href="#cb2-393" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-394"><a href="#cb2-394" aria-hidden="true" tabindex="-1"></a>  <span class="co">#=================================================================================</span></span>
<span id="cb2-395"><a href="#cb2-395" aria-hidden="true" tabindex="-1"></a>  <span class="co">#debug_w_range_pixels = True</span></span>
<span id="cb2-396"><a href="#cb2-396" aria-hidden="true" tabindex="-1"></a>  <span class="kw">def</span> w_range_pixels(<span class="va">self</span>, x,a,b, debug<span class="op">=</span><span class="va">False</span>):</span>
<span id="cb2-397"><a href="#cb2-397" aria-hidden="true" tabindex="-1"></a>    <span class="co">'''</span></span>
<span id="cb2-398"><a href="#cb2-398" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns a pixel index list of all pixels between wavelength 'a' and 'b'. </span></span>
<span id="cb2-399"><a href="#cb2-399" aria-hidden="true" tabindex="-1"></a><span class="co">    Parameters:</span></span>
<span id="cb2-400"><a href="#cb2-400" aria-hidden="true" tabindex="-1"></a><span class="co">      x   A numpy array of wavlengths for each pixel</span></span>
<span id="cb2-401"><a href="#cb2-401" aria-hidden="true" tabindex="-1"></a><span class="co">      a   Starting wavelength</span></span>
<span id="cb2-402"><a href="#cb2-402" aria-hidden="true" tabindex="-1"></a><span class="co">      b   Ending wavelength</span></span>
<span id="cb2-403"><a href="#cb2-403" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb2-404"><a href="#cb2-404" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns:</span></span>
<span id="cb2-405"><a href="#cb2-405" aria-hidden="true" tabindex="-1"></a><span class="co">      A list of index values from wavelength 'a' to 'b'</span></span>
<span id="cb2-406"><a href="#cb2-406" aria-hidden="true" tabindex="-1"></a><span class="co">    '''</span></span>
<span id="cb2-407"><a href="#cb2-407" aria-hidden="true" tabindex="-1"></a>    rv <span class="op">=</span> np.where(np.logical_and( x<span class="op">&gt;</span>a, x<span class="op">&lt;</span>b) )</span>
<span id="cb2-408"><a href="#cb2-408" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> rv</span>
<span id="cb2-409"><a href="#cb2-409" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-410"><a href="#cb2-410" aria-hidden="true" tabindex="-1"></a>  <span class="co">#=================================================================================</span></span>
<span id="cb2-411"><a href="#cb2-411" aria-hidden="true" tabindex="-1"></a>  <span class="co">#debug_get_fluorescence = False</span></span>
<span id="cb2-412"><a href="#cb2-412" aria-hidden="true" tabindex="-1"></a>  <span class="kw">def</span> get_fluorescence(<span class="va">self</span>, x, y, fl_start<span class="op">=</span><span class="dv">0</span>, fl_stop<span class="op">=</span><span class="dv">0</span>, base_start<span class="op">=</span><span class="dv">0</span>, base_stop<span class="op">=</span><span class="dv">0</span>, debug<span class="op">=</span><span class="va">False</span> ):</span>
<span id="cb2-413"><a href="#cb2-413" aria-hidden="true" tabindex="-1"></a>    <span class="co">'''</span></span>
<span id="cb2-414"><a href="#cb2-414" aria-hidden="true" tabindex="-1"></a><span class="co">    '''</span></span>
<span id="cb2-415"><a href="#cb2-415" aria-hidden="true" tabindex="-1"></a>    fl_sig <span class="op">=</span> y[<span class="va">self</span>.w_range_pixels(x, fl_start, fl_stop )].mean()         <span class="co"># Get the Fluor signal mean value</span></span>
<span id="cb2-416"><a href="#cb2-416" aria-hidden="true" tabindex="-1"></a>    by <span class="op">=</span> y[<span class="va">self</span>.w_range_pixels(x, base_start, base_start<span class="op">+</span><span class="dv">1</span>)].mean()</span>
<span id="cb2-417"><a href="#cb2-417" aria-hidden="true" tabindex="-1"></a>    ey <span class="op">=</span> y[<span class="va">self</span>.w_range_pixels(x, base_stop, base_stop<span class="op">+</span><span class="dv">1</span>)].mean()</span>
<span id="cb2-418"><a href="#cb2-418" aria-hidden="true" tabindex="-1"></a>    cw <span class="op">=</span> (fl_stop <span class="op">-</span> fl_start) <span class="op">/</span> <span class="dv">2</span>  <span class="op">+</span> fl_start                                       <span class="co"># Compute center wavelength</span></span>
<span id="cb2-419"><a href="#cb2-419" aria-hidden="true" tabindex="-1"></a>    dydx <span class="op">=</span> (ey <span class="op">-</span> by)<span class="op">/</span>(base_stop <span class="op">-</span> base_start )</span>
<span id="cb2-420"><a href="#cb2-420" aria-hidden="true" tabindex="-1"></a>    sf <span class="op">=</span> dydx <span class="op">*</span> (cw <span class="op">-</span> base_start)</span>
<span id="cb2-421"><a href="#cb2-421" aria-hidden="true" tabindex="-1"></a>    rv <span class="op">=</span> fl_sig <span class="op">+</span> sf</span>
<span id="cb2-422"><a href="#cb2-422" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> debug:</span>
<span id="cb2-423"><a href="#cb2-423" aria-hidden="true" tabindex="-1"></a>      <span class="bu">print</span>(<span class="st">'get_fluorescence():'</span>, fl_sig, by, ey, cw, dydx, sf, rv)</span>
<span id="cb2-424"><a href="#cb2-424" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> rv</span>
<span id="cb2-425"><a href="#cb2-425" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-426"><a href="#cb2-426" aria-hidden="true" tabindex="-1"></a>  <span class="co">#=================================================================================</span></span>
<span id="cb2-427"><a href="#cb2-427" aria-hidden="true" tabindex="-1"></a>  <span class="kw">def</span> get_fluorescence_700(<span class="va">self</span>, x, y):</span>
<span id="cb2-428"><a href="#cb2-428" aria-hidden="true" tabindex="-1"></a>    <span class="co">'''</span></span>
<span id="cb2-429"><a href="#cb2-429" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns the fluorescence value at 700nm.</span></span>
<span id="cb2-430"><a href="#cb2-430" aria-hidden="true" tabindex="-1"></a><span class="co">    '''</span></span>
<span id="cb2-431"><a href="#cb2-431" aria-hidden="true" tabindex="-1"></a>    rv <span class="op">=</span> <span class="va">self</span>.get_fluorescence( x, y, fl_start<span class="op">=</span><span class="dv">693</span>, fl_stop<span class="op">=</span><span class="dv">710</span>, base_start<span class="op">=</span><span class="dv">668</span>, base_stop<span class="op">=</span><span class="dv">740</span> )</span>
<span id="cb2-432"><a href="#cb2-432" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> rv</span>
<span id="cb2-433"><a href="#cb2-433" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-434"><a href="#cb2-434" aria-hidden="true" tabindex="-1"></a>  <span class="co">#=================================================================================</span></span>
<span id="cb2-435"><a href="#cb2-435" aria-hidden="true" tabindex="-1"></a>  <span class="kw">def</span> get_fluorescence_683(<span class="va">self</span>, x, y):</span>
<span id="cb2-436"><a href="#cb2-436" aria-hidden="true" tabindex="-1"></a>    <span class="co">'''</span></span>
<span id="cb2-437"><a href="#cb2-437" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns the fluorescence value at 683nm.  683nm is Chlorophyll</span></span>
<span id="cb2-438"><a href="#cb2-438" aria-hidden="true" tabindex="-1"></a><span class="co">    '''</span></span>
<span id="cb2-439"><a href="#cb2-439" aria-hidden="true" tabindex="-1"></a>    rv <span class="op">=</span> <span class="va">self</span>.get_fluorescence( x, y, fl_start<span class="op">=</span><span class="dv">678</span>, fl_stop<span class="op">=</span><span class="dv">688</span>, base_start<span class="op">=</span><span class="dv">668</span>, base_stop<span class="op">=</span><span class="dv">740</span> )</span>
<span id="cb2-440"><a href="#cb2-440" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> rv</span>
<span id="cb2-441"><a href="#cb2-441" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-442"><a href="#cb2-442" aria-hidden="true" tabindex="-1"></a>  <span class="co">#=================================================================================</span></span>
<span id="cb2-443"><a href="#cb2-443" aria-hidden="true" tabindex="-1"></a>  <span class="kw">def</span> now_utc(<span class="va">self</span>, fmt<span class="op">=</span><span class="st">'%Y-%m</span><span class="sc">%d</span><span class="st"> %H:%M:%S'</span>):</span>
<span id="cb2-444"><a href="#cb2-444" aria-hidden="true" tabindex="-1"></a>    <span class="co">""" Return the current UTC date and time as a string.  Example return: '2021-0812 15:39:41'.</span></span>
<span id="cb2-445"><a href="#cb2-445" aria-hidden="true" tabindex="-1"></a><span class="co">    See: http://shorturl.at/koOQ7 for timeformat options &amp; directives.</span></span>
<span id="cb2-446"><a href="#cb2-446" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb2-447"><a href="#cb2-447" aria-hidden="true" tabindex="-1"></a>    t <span class="op">=</span> dt.datetime.utcnow()</span>
<span id="cb2-448"><a href="#cb2-448" aria-hidden="true" tabindex="-1"></a>    ts <span class="op">=</span> <span class="ss">f'</span><span class="sc">{</span>t<span class="sc">:</span>{fmt}<span class="sc">}</span><span class="ss">'</span></span>
<span id="cb2-449"><a href="#cb2-449" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> ts</span>
<span id="cb2-450"><a href="#cb2-450" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-451"><a href="#cb2-451" aria-hidden="true" tabindex="-1"></a>  <span class="co">#=================================================================================</span></span>
<span id="cb2-452"><a href="#cb2-452" aria-hidden="true" tabindex="-1"></a>  <span class="co">#debug_is_water = False</span></span>
<span id="cb2-453"><a href="#cb2-453" aria-hidden="true" tabindex="-1"></a>  <span class="kw">def</span> is_water(<span class="va">self</span>, x,y, debug<span class="op">=</span><span class="va">False</span>):</span>
<span id="cb2-454"><a href="#cb2-454" aria-hidden="true" tabindex="-1"></a>    <span class="co">'''</span></span>
<span id="cb2-455"><a href="#cb2-455" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns the mean signal value between 840nm and 860nm wavelengths.  Since water absorbs IR.</span></span>
<span id="cb2-456"><a href="#cb2-456" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-457"><a href="#cb2-457" aria-hidden="true" tabindex="-1"></a><span class="co">    Inputs:</span></span>
<span id="cb2-458"><a href="#cb2-458" aria-hidden="true" tabindex="-1"></a><span class="co">      x   A numpy array of wavlengths for each pixel</span></span>
<span id="cb2-459"><a href="#cb2-459" aria-hidden="true" tabindex="-1"></a><span class="co">      y   A numpy array of intensity values at each wavelength.  x and y mus be the same size.</span></span>
<span id="cb2-460"><a href="#cb2-460" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-461"><a href="#cb2-461" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns:</span></span>
<span id="cb2-462"><a href="#cb2-462" aria-hidden="true" tabindex="-1"></a><span class="co">      The mean signal value between 840nm and 860nm.  The signal level is not currently normalized</span></span>
<span id="cb2-463"><a href="#cb2-463" aria-hidden="true" tabindex="-1"></a><span class="co">      for anything, exposure, etc.  Threshold is around 4.0.  Above 4, land or glint.</span></span>
<span id="cb2-464"><a href="#cb2-464" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-465"><a href="#cb2-465" aria-hidden="true" tabindex="-1"></a><span class="co">    References: </span></span>
<span id="cb2-466"><a href="#cb2-466" aria-hidden="true" tabindex="-1"></a><span class="co">    Application of the water-related spectral reflectance indices: A review</span></span>
<span id="cb2-467"><a href="#cb2-467" aria-hidden="true" tabindex="-1"></a><span class="co">    https://www.sciencedirect.com/science/article/abs/pii/S1470160X18308215</span></span>
<span id="cb2-468"><a href="#cb2-468" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-469"><a href="#cb2-469" aria-hidden="true" tabindex="-1"></a><span class="co">    '''</span></span>
<span id="cb2-470"><a href="#cb2-470" aria-hidden="true" tabindex="-1"></a>    rv <span class="op">=</span> y[<span class="va">self</span>.w_range_pixels(x,<span class="dv">840</span>,<span class="dv">860</span>)].mean()</span>
<span id="cb2-471"><a href="#cb2-471" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> rv</span>
<span id="cb2-472"><a href="#cb2-472" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-473"><a href="#cb2-473" aria-hidden="true" tabindex="-1"></a>  <span class="co">#=================================================================================</span></span>
<span id="cb2-474"><a href="#cb2-474" aria-hidden="true" tabindex="-1"></a>  <span class="co">#debug_get_list_of_flight_lines = False</span></span>
<span id="cb2-475"><a href="#cb2-475" aria-hidden="true" tabindex="-1"></a>  <span class="kw">def</span> get_list_of_flight_lines(<span class="va">self</span>, p, debug<span class="op">=</span><span class="va">False</span>):</span>
<span id="cb2-476"><a href="#cb2-476" aria-hidden="true" tabindex="-1"></a>    <span class="co">'''Returns a list of flightline subdirs on path p.</span></span>
<span id="cb2-477"><a href="#cb2-477" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb2-478"><a href="#cb2-478" aria-hidden="true" tabindex="-1"></a><span class="co">    Parameters:</span></span>
<span id="cb2-479"><a href="#cb2-479" aria-hidden="true" tabindex="-1"></a><span class="co">    -----------</span></span>
<span id="cb2-480"><a href="#cb2-480" aria-hidden="true" tabindex="-1"></a><span class="co">    p : str</span></span>
<span id="cb2-481"><a href="#cb2-481" aria-hidden="true" tabindex="-1"></a><span class="co">        Path name.</span></span>
<span id="cb2-482"><a href="#cb2-482" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-483"><a href="#cb2-483" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns:</span></span>
<span id="cb2-484"><a href="#cb2-484" aria-hidden="true" tabindex="-1"></a><span class="co">    --------</span></span>
<span id="cb2-485"><a href="#cb2-485" aria-hidden="true" tabindex="-1"></a><span class="co">    list</span></span>
<span id="cb2-486"><a href="#cb2-486" aria-hidden="true" tabindex="-1"></a><span class="co">        A list of full pathnames to individul flightlines.</span></span>
<span id="cb2-487"><a href="#cb2-487" aria-hidden="true" tabindex="-1"></a><span class="co">    '''</span></span>
<span id="cb2-488"><a href="#cb2-488" aria-hidden="true" tabindex="-1"></a>    l <span class="op">=</span> glob.glob(p<span class="op">+</span><span class="st">'/[0-9]*[!a-z]'</span>)</span>
<span id="cb2-489"><a href="#cb2-489" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> l</span>
<span id="cb2-490"><a href="#cb2-490" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-491"><a href="#cb2-491" aria-hidden="true" tabindex="-1"></a>  <span class="co">#=================================================================================</span></span>
<span id="cb2-492"><a href="#cb2-492" aria-hidden="true" tabindex="-1"></a>  <span class="co">#debug_get_list_of_hab_files = False</span></span>
<span id="cb2-493"><a href="#cb2-493" aria-hidden="true" tabindex="-1"></a>  <span class="kw">def</span> get_list_of_hab_files(<span class="va">self</span>, p, subdir<span class="op">=</span><span class="st">''</span>, ext<span class="op">=</span><span class="st">''</span>, debug<span class="op">=</span><span class="va">False</span>):</span>
<span id="cb2-494"><a href="#cb2-494" aria-hidden="true" tabindex="-1"></a>    <span class="co">'''Returns a list of hab files in p/subdir with the specified file extension.  </span></span>
<span id="cb2-495"><a href="#cb2-495" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb2-496"><a href="#cb2-496" aria-hidden="true" tabindex="-1"></a><span class="co">    Parameters:</span></span>
<span id="cb2-497"><a href="#cb2-497" aria-hidden="true" tabindex="-1"></a><span class="co">    p : str</span></span>
<span id="cb2-498"><a href="#cb2-498" aria-hidden="true" tabindex="-1"></a><span class="co">    subdir : str Default = ''</span></span>
<span id="cb2-499"><a href="#cb2-499" aria-hidden="true" tabindex="-1"></a><span class="co">    ext : str Default = ''</span></span>
<span id="cb2-500"><a href="#cb2-500" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-501"><a href="#cb2-501" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns:</span></span>
<span id="cb2-502"><a href="#cb2-502" aria-hidden="true" tabindex="-1"></a><span class="co">    --------</span></span>
<span id="cb2-503"><a href="#cb2-503" aria-hidden="true" tabindex="-1"></a><span class="co">    list</span></span>
<span id="cb2-504"><a href="#cb2-504" aria-hidden="true" tabindex="-1"></a><span class="co">        A list of  full pathnames.</span></span>
<span id="cb2-505"><a href="#cb2-505" aria-hidden="true" tabindex="-1"></a><span class="co">    '''</span></span>
<span id="cb2-506"><a href="#cb2-506" aria-hidden="true" tabindex="-1"></a>    gs <span class="op">=</span> p<span class="op">+</span><span class="ss">f'/</span><span class="sc">{</span>subdir<span class="sc">}</span><span class="ss">/*.'</span><span class="op">+</span>ext</span>
<span id="cb2-507"><a href="#cb2-507" aria-hidden="true" tabindex="-1"></a>    js <span class="op">=</span> glob.glob(gs)</span>
<span id="cb2-508"><a href="#cb2-508" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> js</span>
<span id="cb2-509"><a href="#cb2-509" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-510"><a href="#cb2-510" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="va">__name__</span> <span class="op">==</span> <span class="st">'__main__'</span>:</span>
<span id="cb2-511"><a href="#cb2-511" aria-hidden="true" tabindex="-1"></a>  ths <span class="op">=</span> HyperSpec()</span>
<span id="cb2-512"><a href="#cb2-512" aria-hidden="true" tabindex="-1"></a>  <span class="bu">print</span>(<span class="ss">f'</span><span class="sc">{</span>ths<span class="sc">.</span>now_utc()<span class="sc">}</span><span class="ss">: The HyperSpectral class has been created.'</span>)</span>
<span id="cb2-513"><a href="#cb2-513" aria-hidden="true" tabindex="-1"></a>  <span class="kw">del</span> ths</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co">#@title Test: HyperSpectral.{ form-width: "30%" }</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="co">#@title Test hs.read_gps_file_to_df(Gps_File_Name) { form-width: "30%" }</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co">#TTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTT</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Test read_gps_file_to_df(Gps_File_Name)</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>debug_read_gps_file_to_df <span class="op">=</span> <span class="va">False</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="va">__name__</span> <span class="op">==</span> <span class="st">'__main__'</span>:</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> debug_read_gps_file_to_df:</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>    <span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>    <span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">'Testing: read_gps_file_to_df(Gps_File_Name)'</span>)</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="st">'HyperSpec'</span> <span class="kw">in</span> <span class="bu">dir</span>():</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>      hs <span class="op">=</span> HyperSpec()</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>    Gps_File_Name <span class="op">=</span> <span class="st">'/content/drive/MyDrive/Missions/2021-1208-HAB-Lake-Parker/2021-1208/2021-1208-175324-910850-mission-gps.txt'</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>    gps_df <span class="op">=</span> hs.read_gps_file_to_df(Gps_File_Name, debug<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>    display(gps_df)</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a><span class="co">#@title Testing hs.get_bearing() { form-width: "30%" }</span></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a><span class="co">#TTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTT</span></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="va">__name__</span> <span class="op">==</span> <span class="st">'__main__'</span>:</span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>  debug_get_bearing <span class="op">=</span> <span class="va">False</span></span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> debug_get_bearing:</span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>    lst <span class="op">=</span> [ [<span class="dv">30</span>,<span class="dv">29</span>, <span class="op">-</span><span class="dv">75</span>, <span class="op">-</span><span class="dv">75</span>],</span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>            [<span class="dv">29</span>,<span class="dv">30</span>, <span class="op">-</span><span class="dv">75</span>, <span class="op">-</span><span class="dv">75</span>],</span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>            [<span class="dv">30</span>,<span class="dv">30</span>, <span class="op">-</span><span class="dv">76</span>, <span class="op">-</span><span class="dv">75</span>],</span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>            [<span class="dv">30</span>,<span class="dv">30</span>, <span class="op">-</span><span class="dv">75</span>, <span class="op">-</span><span class="dv">76</span>] ]</span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">'</span><span class="ch">\n</span><span class="st">Testing get_bearing()'</span>)</span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> t <span class="kw">in</span> lst:</span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a>      v <span class="op">=</span> hs.get_bearing( lat1<span class="op">=</span>t[<span class="dv">0</span>], lat2<span class="op">=</span>t[<span class="dv">1</span>], long1<span class="op">=</span>t[<span class="dv">2</span>], long2<span class="op">=</span>t[<span class="dv">3</span>] )</span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a>      <span class="bu">print</span>( <span class="ss">f'  </span><span class="sc">{</span>t<span class="sc">}</span><span class="ss">, </span><span class="sc">{</span>v<span class="sc">:6.2f}</span><span class="ss">'</span>)</span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a><span class="co">#@title Testing: hs.hms2sod( t ) { form-width: "30%" }</span></span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a><span class="co">#TTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTT</span></span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="va">__name__</span> <span class="op">==</span> <span class="st">'__main__'</span>: </span>
<span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a>  debug_hms2sod <span class="op">=</span> <span class="va">False</span></span>
<span id="cb3-35"><a href="#cb3-35" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> debug_hms2sod:</span>
<span id="cb3-36"><a href="#cb3-36" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">'</span><span class="ch">\n</span><span class="st">Testing: hs.hms2sod( t )'</span>)</span>
<span id="cb3-37"><a href="#cb3-37" aria-hidden="true" tabindex="-1"></a>    tt <span class="op">=</span> [<span class="st">'00:00:00'</span>, <span class="st">'0:0:0'</span>, <span class="st">'23:59:59'</span>, <span class="st">'12:00:00'</span>]</span>
<span id="cb3-38"><a href="#cb3-38" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> t <span class="kw">in</span> tt:</span>
<span id="cb3-39"><a href="#cb3-39" aria-hidden="true" tabindex="-1"></a>      rv <span class="op">=</span> hs.hms2sod( t )</span>
<span id="cb3-40"><a href="#cb3-40" aria-hidden="true" tabindex="-1"></a>      <span class="bu">print</span>(t, rv)</span>
<span id="cb3-41"><a href="#cb3-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-42"><a href="#cb3-42" aria-hidden="true" tabindex="-1"></a><span class="co">#@title Testing:hs.compute_gps_positions(gps_df, df)') { form-width: "30%" }</span></span>
<span id="cb3-43"><a href="#cb3-43" aria-hidden="true" tabindex="-1"></a><span class="co">#TTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTT</span></span>
<span id="cb3-44"><a href="#cb3-44" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="va">__name__</span> <span class="op">==</span> <span class="st">'__main__'</span>: </span>
<span id="cb3-45"><a href="#cb3-45" aria-hidden="true" tabindex="-1"></a>  debug_compute_gps_positions <span class="op">=</span> <span class="va">False</span></span>
<span id="cb3-46"><a href="#cb3-46" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> debug_compute_gps_positions:</span>
<span id="cb3-47"><a href="#cb3-47" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">'</span><span class="ch">\n</span><span class="st">Testing: hs.compute_gps_positions(gps_df, df)'</span>)</span>
<span id="cb3-48"><a href="#cb3-48" aria-hidden="true" tabindex="-1"></a>    gps_df <span class="op">=</span> hs.read_gps_file_to_df(Gps_File_Name)</span>
<span id="cb3-49"><a href="#cb3-49" aria-hidden="true" tabindex="-1"></a>    sdf <span class="op">=</span> hs.compute_gps_positions(gps_df, df)</span>
<span id="cb3-50"><a href="#cb3-50" aria-hidden="true" tabindex="-1"></a>    display(sdf)</span>
<span id="cb3-51"><a href="#cb3-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-52"><a href="#cb3-52" aria-hidden="true" tabindex="-1"></a><span class="co">#TTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTT</span></span>
<span id="cb3-53"><a href="#cb3-53" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="va">__name__</span> <span class="op">==</span> <span class="st">"__main__"</span>: </span>
<span id="cb3-54"><a href="#cb3-54" aria-hidden="true" tabindex="-1"></a>  debug_w_range_pixels <span class="op">=</span> <span class="va">False</span></span>
<span id="cb3-55"><a href="#cb3-55" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> debug_w_range_pixels:</span>
<span id="cb3-56"><a href="#cb3-56" aria-hidden="true" tabindex="-1"></a>    lst <span class="op">=</span> hs.w_range_pixels( x, <span class="dv">678</span>, <span class="dv">680</span>)</span>
<span id="cb3-57"><a href="#cb3-57" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f'</span><span class="ch">\n</span><span class="ss">hs.w_range_pixels(): Pixel index values between 678 and 680nm: </span><span class="sc">{</span>lst<span class="sc">}</span><span class="ch">\n</span><span class="ss"> y values:</span><span class="sc">{</span> y[lst]<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb3-58"><a href="#cb3-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-59"><a href="#cb3-59" aria-hidden="true" tabindex="-1"></a><span class="co">#TTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTT</span></span>
<span id="cb3-60"><a href="#cb3-60" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="va">__name__</span> <span class="op">==</span> <span class="st">"__main__"</span>:</span>
<span id="cb3-61"><a href="#cb3-61" aria-hidden="true" tabindex="-1"></a>  debug_get_fluorescence <span class="op">=</span> <span class="va">False</span></span>
<span id="cb3-62"><a href="#cb3-62" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> debug_get_fluorescence:</span>
<span id="cb3-63"><a href="#cb3-63" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">'</span><span class="ch">\n</span><span class="st">Testing: hs.get_fluorescence_683(x, y )'</span>)</span>
<span id="cb3-64"><a href="#cb3-64" aria-hidden="true" tabindex="-1"></a>    rv <span class="op">=</span> hs.get_fluorescence_683(x, y )</span>
<span id="cb3-65"><a href="#cb3-65" aria-hidden="true" tabindex="-1"></a>    rv2 <span class="op">=</span> hs.get_fluorescence_700(x, y )</span>
<span id="cb3-66"><a href="#cb3-66" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f'  get_fluorescence_683():   returned: </span><span class="sc">{</span>rv<span class="sc">}</span><span class="ch">\n</span><span class="ss">'</span></span>
<span id="cb3-67"><a href="#cb3-67" aria-hidden="true" tabindex="-1"></a>          <span class="ss">f'  get_fluorescence_700:     returned: </span><span class="sc">{</span>rv2<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb3-68"><a href="#cb3-68" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-69"><a href="#cb3-69" aria-hidden="true" tabindex="-1"></a><span class="co">#TTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTT</span></span>
<span id="cb3-70"><a href="#cb3-70" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="va">__name__</span> <span class="op">==</span> <span class="st">"__main__"</span>:</span>
<span id="cb3-71"><a href="#cb3-71" aria-hidden="true" tabindex="-1"></a>  debug_is_water <span class="op">=</span> <span class="va">False</span></span>
<span id="cb3-72"><a href="#cb3-72" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> debug_is_water <span class="op">==</span> <span class="va">True</span>:</span>
<span id="cb3-73"><a href="#cb3-73" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">'</span><span class="ch">\n</span><span class="st">Testing: hs.is_water(x,y)'</span>)</span>
<span id="cb3-74"><a href="#cb3-74" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>( <span class="ss">f'  test hs.is_water(): </span><span class="sc">{</span> hs<span class="sc">.</span>is_water(x,y) <span class="sc">}</span><span class="ss">'</span> )</span>
<span id="cb3-75"><a href="#cb3-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-76"><a href="#cb3-76" aria-hidden="true" tabindex="-1"></a><span class="co">#TTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTT</span></span>
<span id="cb3-77"><a href="#cb3-77" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="va">__name__</span> <span class="op">==</span> <span class="st">"__main__"</span>:</span>
<span id="cb3-78"><a href="#cb3-78" aria-hidden="true" tabindex="-1"></a>  debug_get_list_of_flight_lines <span class="op">=</span> <span class="va">False</span></span>
<span id="cb3-79"><a href="#cb3-79" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> debug_get_list_of_flight_lines:</span>
<span id="cb3-80"><a href="#cb3-80" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">'</span><span class="ch">\n</span><span class="st">Testing: hs.get_list_of_flight_lines(p)'</span>)</span>
<span id="cb3-81"><a href="#cb3-81" aria-hidden="true" tabindex="-1"></a>    test_path_list <span class="op">=</span> get_list_of_flight_lines(<span class="st">'/content/2021-0717-HAB-pie-NO-PIX'</span>)</span>
<span id="cb3-82"><a href="#cb3-82" aria-hidden="true" tabindex="-1"></a>    display(test_path_list)</span>
<span id="cb3-83"><a href="#cb3-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-84"><a href="#cb3-84" aria-hidden="true" tabindex="-1"></a><span class="co">#TTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTT</span></span>
<span id="cb3-85"><a href="#cb3-85" aria-hidden="true" tabindex="-1"></a>debug_get_list_of_hab_files <span class="op">=</span> <span class="va">False</span></span>
<span id="cb3-86"><a href="#cb3-86" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="va">__name__</span> <span class="op">==</span> <span class="st">"__main__"</span>:</span>
<span id="cb3-87"><a href="#cb3-87" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> debug_get_list_of_hab_files:</span>
<span id="cb3-88"><a href="#cb3-88" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">'</span><span class="ch">\n</span><span class="st">Testing: hs.get_list_of_hab_files()'</span>)</span>
<span id="cb3-89"><a href="#cb3-89" aria-hidden="true" tabindex="-1"></a>    flight_line_list <span class="op">=</span> hs.get_list_of_flight_lines(<span class="st">'/content/drive/MyDrive/Missions/2021-0717-HAB-pie'</span>)</span>
<span id="cb3-90"><a href="#cb3-90" aria-hidden="true" tabindex="-1"></a>    rv_get_list_of_hab_files <span class="op">=</span> hs.get_list_of_hab_files( flight_line_list[<span class="dv">1</span>], subdir<span class="op">=</span><span class="st">'hab_spectra'</span>, ext<span class="op">=</span><span class="st">'json'</span>)</span>
<span id="cb3-91"><a href="#cb3-91" aria-hidden="true" tabindex="-1"></a>    display(rv_get_list_of_hab_files)</span>
<span id="cb3-92"><a href="#cb3-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-93"><a href="#cb3-93" aria-hidden="true" tabindex="-1"></a><span class="co">#@title Tests: HyperSpectral Wavelength Calibration. { form-width: "30%" }</span></span>
<span id="cb3-94"><a href="#cb3-94" aria-hidden="true" tabindex="-1"></a><span class="co">#TTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTT</span></span>
<span id="cb3-95"><a href="#cb3-95" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a spectra obj</span></span>
<span id="cb3-96"><a href="#cb3-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-97"><a href="#cb3-97" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="va">__name__</span> <span class="op">==</span> <span class="st">'__main__'</span>:</span>
<span id="cb3-98"><a href="#cb3-98" aria-hidden="true" tabindex="-1"></a>  debug_hyperspectral <span class="op">=</span> <span class="va">False</span></span>
<span id="cb3-99"><a href="#cb3-99" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> debug_hyperspectral:</span>
<span id="cb3-100"><a href="#cb3-100" aria-hidden="true" tabindex="-1"></a>    <span class="im">import</span> datetime</span>
<span id="cb3-101"><a href="#cb3-101" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f'</span><span class="sc">{</span>datetime<span class="sc">.</span>datetime<span class="sc">.</span>utcnow() <span class="sc">}</span><span class="ss">: Testing creating HyperSpectral'</span>)</span>
<span id="cb3-102"><a href="#cb3-102" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Make sure the 'HyperSpec' class cell has been run, and if so, use it.</span></span>
<span id="cb3-103"><a href="#cb3-103" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="st">'HyperSpec'</span> <span class="kw">in</span> <span class="bu">dir</span>():</span>
<span id="cb3-104"><a href="#cb3-104" aria-hidden="true" tabindex="-1"></a>      hs <span class="op">=</span> HyperSpec()</span>
<span id="cb3-105"><a href="#cb3-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-106"><a href="#cb3-106" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Use a json spectra to initialize things.</span></span>
<span id="cb3-107"><a href="#cb3-107" aria-hidden="true" tabindex="-1"></a>      <span class="bu">print</span>(<span class="ss">f'</span><span class="sc">{</span>hs<span class="sc">.</span>now_utc()<span class="sc">}</span><span class="ss">: Loading json file to calibrate wavelength.'</span>)</span>
<span id="cb3-108"><a href="#cb3-108" aria-hidden="true" tabindex="-1"></a>      fn <span class="op">=</span> <span class="st">'/content/drive/MyDrive/Missions/2021-0717-HAB-pie/165347/hab_spectra/2021-0717-165348-272814-spec.json'</span></span>
<span id="cb3-109"><a href="#cb3-109" aria-hidden="true" tabindex="-1"></a>      hs.configure_json_spectra(fn)</span>
<span id="cb3-110"><a href="#cb3-110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-111"><a href="#cb3-111" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Calibrate the spectra for wavelength in nanometers</span></span>
<span id="cb3-112"><a href="#cb3-112" aria-hidden="true" tabindex="-1"></a>      <span class="bu">print</span>(<span class="ss">f'</span><span class="sc">{</span>hs<span class="sc">.</span>now_utc()<span class="sc">}</span><span class="ss">: Calibrating wavelength.'</span>)</span>
<span id="cb3-113"><a href="#cb3-113" aria-hidden="true" tabindex="-1"></a>      hs.calibrate_using_2_wavelengths(pixel0<span class="op">=</span><span class="dv">73</span>, wavelength0<span class="op">=</span><span class="fl">430.774</span>, pixel1<span class="op">=</span><span class="dv">941</span>, wavelength1<span class="op">=</span><span class="fl">759.370</span> )</span>
<span id="cb3-114"><a href="#cb3-114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-115"><a href="#cb3-115" aria-hidden="true" tabindex="-1"></a>      <span class="bu">print</span>(<span class="st">'</span><span class="ch">\n</span><span class="st">Wavelength Calibration Data:</span><span class="ch">\n</span><span class="st">'</span></span>
<span id="cb3-116"><a href="#cb3-116" aria-hidden="true" tabindex="-1"></a>      <span class="st">'                     First      Second</span><span class="ch">\n</span><span class="st">'</span></span>
<span id="cb3-117"><a href="#cb3-117" aria-hidden="true" tabindex="-1"></a>      <span class="ss">f'   Wavelengths (nm): </span><span class="sc">{</span>hs<span class="sc">.</span>wavelengths[<span class="dv">73</span>]<span class="sc">:7.3f}</span><span class="ss">      </span><span class="sc">{</span>hs<span class="sc">.</span>wavelengths[<span class="dv">941</span>]<span class="sc">:7.3f}</span><span class="ch">\n</span><span class="ss">'</span></span>
<span id="cb3-118"><a href="#cb3-118" aria-hidden="true" tabindex="-1"></a>      <span class="ss">f'     Pixel Location: </span><span class="sc">{</span><span class="dv">73</span><span class="sc">:3d}</span><span class="ss">          </span><span class="sc">{</span><span class="dv">941</span><span class="sc">:3d}</span><span class="ch">\n</span><span class="ss">'</span>)</span>
<span id="cb3-119"><a href="#cb3-119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-120"><a href="#cb3-120" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Read a spectra array from a file into s</span></span>
<span id="cb3-121"><a href="#cb3-121" aria-hidden="true" tabindex="-1"></a>      <span class="bu">print</span>(<span class="ss">f'</span><span class="sc">{</span>hs<span class="sc">.</span>now_utc()<span class="sc">}</span><span class="ss">: Reading a spectra into "s"'</span>)</span>
<span id="cb3-122"><a href="#cb3-122" aria-hidden="true" tabindex="-1"></a>      s <span class="op">=</span> hs.read_spectra( fn )</span>
<span id="cb3-123"><a href="#cb3-123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-124"><a href="#cb3-124" aria-hidden="true" tabindex="-1"></a><span class="co">#@title Tests: hs.nearest_rgb_image( Spectra_File_Name ) { form-width: "30%" }</span></span>
<span id="cb3-125"><a href="#cb3-125" aria-hidden="true" tabindex="-1"></a><span class="co">#TTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTT</span></span>
<span id="cb3-126"><a href="#cb3-126" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="va">__name__</span> <span class="op">==</span> <span class="st">'__main__'</span>:</span>
<span id="cb3-127"><a href="#cb3-127" aria-hidden="true" tabindex="-1"></a>  debug_show_RGB_at_spec <span class="op">=</span> <span class="va">False</span></span>
<span id="cb3-128"><a href="#cb3-128" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> <span class="kw">not</span> <span class="st">'HyperSpec'</span> <span class="kw">in</span> <span class="bu">dir</span>():</span>
<span id="cb3-129"><a href="#cb3-129" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span>hs<span class="sc">.</span>now_utc()<span class="sc">}</span><span class="ss">: The HyperSpec class isn't loaded.  Load the class, and rerun."</span>)</span>
<span id="cb3-130"><a href="#cb3-130" aria-hidden="true" tabindex="-1"></a>  <span class="cf">else</span>:</span>
<span id="cb3-131"><a href="#cb3-131" aria-hidden="true" tabindex="-1"></a>    hs <span class="op">=</span> HyperSpec()</span>
<span id="cb3-132"><a href="#cb3-132" aria-hidden="true" tabindex="-1"></a>    <span class="co"># import glob</span></span>
<span id="cb3-133"><a href="#cb3-133" aria-hidden="true" tabindex="-1"></a>    <span class="co">#img_path = '/content/drive/MyDrive/Missions/2021-0717-HAB-pie/165347/hab_rgb/2021-0717-170033-323503-rgb.jpg'</span></span>
<span id="cb3-134"><a href="#cb3-134" aria-hidden="true" tabindex="-1"></a>    <span class="co">#print(Spectra_File_Name,"\n",img_path)</span></span>
<span id="cb3-135"><a href="#cb3-135" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> debug_show_RGB_at_spec:</span>
<span id="cb3-136"><a href="#cb3-136" aria-hidden="true" tabindex="-1"></a>      Spectra_File_Name <span class="op">=</span> <span class="st">'/content/drive/MyDrive/Missions/2021-0717-HAB-pie/164443/hab_spectra/2021-0717-164525-775042-spec.json'</span></span>
<span id="cb3-137"><a href="#cb3-137" aria-hidden="true" tabindex="-1"></a>      <span class="bu">print</span>(</span>
<span id="cb3-138"><a href="#cb3-138" aria-hidden="true" tabindex="-1"></a>      <span class="ss">f'    Input Json spectra file: </span><span class="sc">{</span>Spectra_File_Name<span class="sc">}</span><span class="ch">\n</span><span class="ss">'</span></span>
<span id="cb3-139"><a href="#cb3-139" aria-hidden="true" tabindex="-1"></a>      <span class="ss">f'        Nearest RGB File is: </span><span class="sc">{</span>hs<span class="sc">.</span>nearest_rgb_image( Spectra_File_Name )<span class="sc">}</span><span class="ss">'</span>  )</span>
<span id="cb3-140"><a href="#cb3-140" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-141"><a href="#cb3-141" aria-hidden="true" tabindex="-1"></a><span class="co">#@title Tests: hs.nearest_rgb_image( Spectra_File_Name ) { form-width: "30%" }</span></span>
<span id="cb3-142"><a href="#cb3-142" aria-hidden="true" tabindex="-1"></a><span class="co">#TTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTT</span></span>
<span id="cb3-143"><a href="#cb3-143" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="va">__name__</span> <span class="op">==</span> <span class="st">'__main__'</span>:</span>
<span id="cb3-144"><a href="#cb3-144" aria-hidden="true" tabindex="-1"></a>  <span class="bu">print</span>(<span class="ss">f'</span><span class="sc">{</span>hs<span class="sc">.</span>now_utc()<span class="sc">}</span><span class="ss">: HyperSpectral Tests have been executed.'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="local-required-methods." class="level3">
<h3 class="anchored" data-anchor-id="local-required-methods.">Local required methods.</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co">#@title w_min( x, y, wstart = 0, wstop = 0, debug=False) { form-width: "30%" }</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="co">#=================================================================================</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="co">#debug_get_fluorescence = False</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span>  w_min( x, y, w_start <span class="op">=</span> <span class="dv">0</span>, w_stop <span class="op">=</span> <span class="dv">0</span>, debug<span class="op">=</span><span class="va">False</span>):</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>  <span class="co">'''</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="co">  '''</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>  sig <span class="op">=</span> y[hs.w_range_pixels(x, w_start, w_stop )].<span class="bu">min</span>()         <span class="co"># </span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>  rv <span class="op">=</span> sig</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> debug:</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">'w_min():'</span>, x, y, wstart, wstop, sig )</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> rv</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a><span class="co">#@title w_max( x, y, wstart = 0, wstop = 0, debug=False)</span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a><span class="co">#=================================================================================</span></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a><span class="co">#debug_get_fluorescence = False</span></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span>  w_max( x, y, w_start <span class="op">=</span> <span class="dv">0</span>, w_stop <span class="op">=</span> <span class="dv">0</span>, debug<span class="op">=</span><span class="va">False</span>):</span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>  <span class="co">'''</span></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a><span class="co">  '''</span></span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>  sig <span class="op">=</span> y[hs.w_range_pixels(x, w_start, w_stop )].<span class="bu">max</span>()         <span class="co">#</span></span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>  rv <span class="op">=</span> sig</span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> debug:</span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">'w_max():'</span>, x, y, wstart, wstop, sig )</span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> rv</span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="va">__name__</span> <span class="op">==</span> <span class="st">'__main__'</span>:</span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a>  <span class="im">from</span> matplotlib <span class="im">import</span> pyplot <span class="im">as</span> plt</span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> <span class="kw">not</span> <span class="st">'HyperSpec'</span> <span class="kw">in</span> <span class="bu">dir</span>():</span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span>hs<span class="sc">.</span>now_utc()<span class="sc">}</span><span class="ss">: The HyperSpec class isn't loaded.  Load the class, and rerun."</span>)</span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a>  <span class="cf">else</span>:</span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a>    hs <span class="op">=</span> HyperSpec()</span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a>    fn <span class="op">=</span> <span class="st">'/content/drive/MyDrive/Missions/2021-1208-HAB-Lake-Parker/2021-1208/183807/hab_spectra/2021-1208-184034-847363-spec.json'</span></span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a>    spectra <span class="op">=</span> hs.read_spectra( fn )</span>
<span id="cb4-34"><a href="#cb4-34" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">'testing w_min &amp; w_max'</span>)</span>
<span id="cb4-35"><a href="#cb4-35" aria-hidden="true" tabindex="-1"></a>    wavelengths <span class="op">=</span> hs.calibrate_using_2_wavelengths(         <span class="co"># Calibrate the spectra for wavelength in nanometers</span></span>
<span id="cb4-36"><a href="#cb4-36" aria-hidden="true" tabindex="-1"></a>        pixel0<span class="op">=</span><span class="dv">73</span>, wavelength0<span class="op">=</span><span class="fl">430.774</span>, </span>
<span id="cb4-37"><a href="#cb4-37" aria-hidden="true" tabindex="-1"></a>        pixel1<span class="op">=</span><span class="dv">941</span>, wavelength1<span class="op">=</span><span class="fl">759.370</span> </span>
<span id="cb4-38"><a href="#cb4-38" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb4-39"><a href="#cb4-39" aria-hidden="true" tabindex="-1"></a>    mn <span class="op">=</span> w_min(hs.wavelengths, spectra, w_start<span class="op">=</span><span class="fl">650.0</span>, w_stop<span class="op">=</span><span class="fl">700.0</span>)</span>
<span id="cb4-40"><a href="#cb4-40" aria-hidden="true" tabindex="-1"></a>    mx <span class="op">=</span> w_max( hs.wavelengths, spectra, w_start<span class="op">=</span><span class="fl">673.0</span>, w_stop<span class="op">=</span><span class="fl">760.0</span>)</span>
<span id="cb4-41"><a href="#cb4-41" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>( mn,</span>
<span id="cb4-42"><a href="#cb4-42" aria-hidden="true" tabindex="-1"></a>          mx)</span>
<span id="cb4-43"><a href="#cb4-43" aria-hidden="true" tabindex="-1"></a>    plt.plot(hs.wavelengths, spectra)</span>
<span id="cb4-44"><a href="#cb4-44" aria-hidden="true" tabindex="-1"></a>    plt.plot([<span class="dv">650</span>, <span class="dv">700</span>],[mn,mn] )</span>
<span id="cb4-45"><a href="#cb4-45" aria-hidden="true" tabindex="-1"></a>    plt.plot([<span class="dv">673</span>, <span class="dv">760</span>], [mx,mx])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>hs.summed_rows</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>spectra</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co">#@title Load required local functions. { form-width: "30%" }</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="co">'''</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="co">'''</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> cv2 <span class="im">as</span> cv</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> datetime <span class="im">as</span> dt</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> geographiclib.geodesic <span class="im">import</span> Geodesic</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> glob</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> google.colab.patches <span class="im">import</span> cv2_imshow <span class="co"># for image display</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pylab <span class="im">as</span> plt</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> PIL <span class="im">import</span> Image   </span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> skimage <span class="im">import</span> io</span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> time</span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> datetime</span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a><span class="co">#=================================================================================</span></span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a><span class="co">#debug_chl_fl = False</span></span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a><span class="co">#def chl_fl(x,y):</span></span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a><span class="co">#  '''</span></span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a><span class="co">#  Returns the value determined by the mean of 680-687nm / 670-678nm.  #</span></span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a><span class="co">#  Inputs:</span></span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a><span class="co">#     x   A numpy array of wavlengths for each pixel</span></span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a><span class="co">#     y   A numpy array of intensity values at each wavelength.  x and y mus be the same size.#</span></span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb7-31"><a href="#cb7-31" aria-hidden="true" tabindex="-1"></a><span class="co">#  Returns:</span></span>
<span id="cb7-32"><a href="#cb7-32" aria-hidden="true" tabindex="-1"></a><span class="co">#    The mean signal value between 840nm and 860nm.  The signal level is not currently normalized</span></span>
<span id="cb7-33"><a href="#cb7-33" aria-hidden="true" tabindex="-1"></a><span class="co">#    for anything, exposure, etc.</span></span>
<span id="cb7-34"><a href="#cb7-34" aria-hidden="true" tabindex="-1"></a><span class="co">#  '''</span></span>
<span id="cb7-35"><a href="#cb7-35" aria-hidden="true" tabindex="-1"></a><span class="co">#  rv = y[hs.w_range_pixels(x,680,687)].mean() / y[hs.w_range_pixels(x,670,678)].mean()</span></span>
<span id="cb7-36"><a href="#cb7-36" aria-hidden="true" tabindex="-1"></a><span class="co">#  return rv</span></span>
<span id="cb7-37"><a href="#cb7-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-38"><a href="#cb7-38" aria-hidden="true" tabindex="-1"></a><span class="co">#TTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTT</span></span>
<span id="cb7-39"><a href="#cb7-39" aria-hidden="true" tabindex="-1"></a><span class="co">#if __name__ == "__main__" and debug_chl_fl==True:</span></span>
<span id="cb7-40"><a href="#cb7-40" aria-hidden="true" tabindex="-1"></a><span class="co">#  print(f'\nTest chl_fl(): returned value: {chl_fl(x,y)}')</span></span>
<span id="cb7-41"><a href="#cb7-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-42"><a href="#cb7-42" aria-hidden="true" tabindex="-1"></a><span class="co">#=================================================================================</span></span>
<span id="cb7-43"><a href="#cb7-43" aria-hidden="true" tabindex="-1"></a><span class="co">#@title Show the nearest image to a spectra file { form-width: "30%" }</span></span>
<span id="cb7-44"><a href="#cb7-44" aria-hidden="true" tabindex="-1"></a>debug_show_RGB_at_spec <span class="op">=</span> <span class="va">True</span></span>
<span id="cb7-45"><a href="#cb7-45" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> show_RGB_at_spec( fn ):</span>
<span id="cb7-46"><a href="#cb7-46" aria-hidden="true" tabindex="-1"></a>  <span class="co">"""</span></span>
<span id="cb7-47"><a href="#cb7-47" aria-hidden="true" tabindex="-1"></a><span class="co">    Locates and displays a photo taken near the time embedded in the Json file 'fn'. </span></span>
<span id="cb7-48"><a href="#cb7-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-49"><a href="#cb7-49" aria-hidden="true" tabindex="-1"></a><span class="co">    Parameters:</span></span>
<span id="cb7-50"><a href="#cb7-50" aria-hidden="true" tabindex="-1"></a><span class="co">    -----------</span></span>
<span id="cb7-51"><a href="#cb7-51" aria-hidden="true" tabindex="-1"></a><span class="co">    fn : string, json spectra full path name</span></span>
<span id="cb7-52"><a href="#cb7-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-53"><a href="#cb7-53" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns:</span></span>
<span id="cb7-54"><a href="#cb7-54" aria-hidden="true" tabindex="-1"></a><span class="co">    --------</span></span>
<span id="cb7-55"><a href="#cb7-55" aria-hidden="true" tabindex="-1"></a><span class="co">    None</span></span>
<span id="cb7-56"><a href="#cb7-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-57"><a href="#cb7-57" aria-hidden="true" tabindex="-1"></a><span class="co">    Description:</span></span>
<span id="cb7-58"><a href="#cb7-58" aria-hidden="true" tabindex="-1"></a><span class="co">    ------------</span></span>
<span id="cb7-59"><a href="#cb7-59" aria-hidden="true" tabindex="-1"></a><span class="co">    Extracts the time from the Json filename, and constructs a cooresponding filename</span></span>
<span id="cb7-60"><a href="#cb7-60" aria-hidden="true" tabindex="-1"></a><span class="co">    for a jpg photo that is closeby.  It does not consider the fractional seconds.</span></span>
<span id="cb7-61"><a href="#cb7-61" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb7-62"><a href="#cb7-62" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> debug_show_RGB_at_spec <span class="op">==</span> <span class="va">False</span>: </span>
<span id="cb7-63"><a href="#cb7-63" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f'show_RGB_at_spec(fn): fn=</span><span class="sc">{</span>fn<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb7-64"><a href="#cb7-64" aria-hidden="true" tabindex="-1"></a>  img_fig <span class="op">=</span> figure(plot_width<span class="op">=</span><span class="dv">400</span>,</span>
<span id="cb7-65"><a href="#cb7-65" aria-hidden="true" tabindex="-1"></a>                   plot_height<span class="op">=</span><span class="dv">400</span>, </span>
<span id="cb7-66"><a href="#cb7-66" aria-hidden="true" tabindex="-1"></a>                   x_range<span class="op">=</span>(<span class="dv">0</span>,<span class="dv">1</span>), </span>
<span id="cb7-67"><a href="#cb7-67" aria-hidden="true" tabindex="-1"></a>                   y_range<span class="op">=</span>(<span class="dv">0</span>,<span class="dv">1</span>)</span>
<span id="cb7-68"><a href="#cb7-68" aria-hidden="true" tabindex="-1"></a>                  )</span>
<span id="cb7-69"><a href="#cb7-69" aria-hidden="true" tabindex="-1"></a>  img_path <span class="op">=</span> hs.nearest_rgb_image( fn )</span>
<span id="cb7-70"><a href="#cb7-70" aria-hidden="true" tabindex="-1"></a>  <span class="bu">print</span>(<span class="st">'Image file:'</span>,img_path)</span>
<span id="cb7-71"><a href="#cb7-71" aria-hidden="true" tabindex="-1"></a>  image <span class="op">=</span> cv.imread(img_path)</span>
<span id="cb7-72"><a href="#cb7-72" aria-hidden="true" tabindex="-1"></a>  scale_percent <span class="op">=</span> <span class="dv">25</span> <span class="co"># percent of original size</span></span>
<span id="cb7-73"><a href="#cb7-73" aria-hidden="true" tabindex="-1"></a>  width <span class="op">=</span> <span class="bu">int</span>(image.shape[<span class="dv">1</span>] <span class="op">*</span> scale_percent <span class="op">/</span> <span class="dv">100</span>)</span>
<span id="cb7-74"><a href="#cb7-74" aria-hidden="true" tabindex="-1"></a>  height <span class="op">=</span> <span class="bu">int</span>(image.shape[<span class="dv">0</span>] <span class="op">*</span> scale_percent <span class="op">/</span> <span class="dv">100</span>)</span>
<span id="cb7-75"><a href="#cb7-75" aria-hidden="true" tabindex="-1"></a>  dim <span class="op">=</span> (width, height)</span>
<span id="cb7-76"><a href="#cb7-76" aria-hidden="true" tabindex="-1"></a>  resized <span class="op">=</span> cv.resize(image, dim, interpolation <span class="op">=</span> cv.INTER_AREA)</span>
<span id="cb7-77"><a href="#cb7-77" aria-hidden="true" tabindex="-1"></a>  cv2_imshow( resized )</span>
<span id="cb7-78"><a href="#cb7-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-79"><a href="#cb7-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-80"><a href="#cb7-80" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="va">__name__</span> <span class="op">==</span> <span class="st">'__main__'</span>:</span>
<span id="cb7-81"><a href="#cb7-81" aria-hidden="true" tabindex="-1"></a>  <span class="bu">print</span>(<span class="ss">f'</span><span class="sc">{</span>datetime<span class="sc">.</span>datetime<span class="sc">.</span>utcnow()<span class="sc">}</span><span class="ss">: local functions loaded and ready.'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="process-data" class="level1">
<h1>Process data</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co">#@title Generate fluorescence values vs time and add in GPS positions and course. { form-width: "40%" }</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="va">__name__</span> <span class="op">==</span> <span class="st">'__main__'</span>:</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>  hs <span class="op">=</span> HyperSpec()</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>  root_data_path <span class="op">=</span> <span class="st">'/content/drive/MyDrive/Missions/2021-0717-HAB-pie/'</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>  Gps_File_Name <span class="op">=</span> <span class="st">"/content/drive/MyDrive/Missions/2021-1208-HAB-Lake-Parker/2021-1208/all-gps.txt"</span> <span class="co">#@param {type:"string"}</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>  Root_Data_Path <span class="op">=</span> <span class="st">"/content/drive/MyDrive/Missions/2021-1208-HAB-Lake-Parker/2021-1208"</span> <span class="co">#@param {type:"string"}</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>  all_specs <span class="op">=</span> hs.get_list_of_json_spectra(Root_Data_Path) <span class="co"># Get a list of json spectra files.</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>  hs.configure_json_spectra(all_specs[<span class="dv">0</span>])                 <span class="co"># Configure spectra.</span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>  wavelengths <span class="op">=</span> hs.calibrate_using_2_wavelengths(         <span class="co"># Calibrate the spectra for wavelength in nanometers</span></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>      pixel0<span class="op">=</span><span class="dv">73</span>, wavelength0<span class="op">=</span><span class="fl">430.774</span>, </span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>      pixel1<span class="op">=</span><span class="dv">941</span>, wavelength1<span class="op">=</span><span class="fl">759.370</span> </span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>  spec_df <span class="op">=</span> hs.json_specs_to_df( all_specs )              <span class="co"># Convert to a dataframe.</span></span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>  gps_df  <span class="op">=</span> hs.read_gps_file_to_df(Gps_File_Name)         <span class="co"># Gather the GPS data to a dataframe.</span></span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a>  spec_df <span class="op">=</span> hs.compute_gps_positions(gps_df, spec_df )    <span class="co"># Compute positions of each spectra.</span></span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a>  chl_fl_lst <span class="op">=</span> []                                         <span class="co"># List to hold chlorophyll fluorescence</span></span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a>  fl700_lst  <span class="op">=</span> []                                         <span class="co"># List to hold 700nm fluorescence</span></span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a>  <span class="bu">print</span>(<span class="ss">f'</span><span class="sc">{</span>hs<span class="sc">.</span>now_utc()<span class="sc">}</span><span class="ss">: Computing chl Fl. &amp; Fl-700'</span>) </span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a>  <span class="bu">print</span>(<span class="st">'Processing:'</span>)    </span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a>  i <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> idx, row <span class="kw">in</span> spec_df.iterrows():</span>
<span id="cb8-29"><a href="#cb8-29" aria-hidden="true" tabindex="-1"></a>    i <span class="op">=</span> i <span class="op">+</span>  <span class="dv">1</span></span>
<span id="cb8-30"><a href="#cb8-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (i <span class="op">%</span> <span class="dv">1000</span>) <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb8-31"><a href="#cb8-31" aria-hidden="true" tabindex="-1"></a>      <span class="bu">print</span>(<span class="ss">f'   </span><span class="sc">{</span>i<span class="sc">}</span><span class="ss"> of </span><span class="sc">{</span><span class="bu">len</span>(spec_df)<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb8-32"><a href="#cb8-32" aria-hidden="true" tabindex="-1"></a>    <span class="cf">with</span> <span class="bu">open</span>( spec_df[<span class="st">'Json_spec'</span>][idx], <span class="st">'r'</span>) <span class="im">as</span> sf:</span>
<span id="cb8-33"><a href="#cb8-33" aria-hidden="true" tabindex="-1"></a>      spectra <span class="op">=</span> hs.read_spectra( sf )</span>
<span id="cb8-34"><a href="#cb8-34" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> hs.is_water(wavelengths,spectra  ) <span class="op">&lt;</span> <span class="fl">4.0</span>:</span>
<span id="cb8-35"><a href="#cb8-35" aria-hidden="true" tabindex="-1"></a>        chl_fl_lst.append( hs.get_fluorescence_683(wavelengths, spectra ))</span>
<span id="cb8-36"><a href="#cb8-36" aria-hidden="true" tabindex="-1"></a>        fl700_lst.append(  hs.get_fluorescence_700(wavelengths, spectra ))</span>
<span id="cb8-37"><a href="#cb8-37" aria-hidden="true" tabindex="-1"></a>      <span class="cf">else</span>:</span>
<span id="cb8-38"><a href="#cb8-38" aria-hidden="true" tabindex="-1"></a>        chl_fl_lst.append(np.nan)</span>
<span id="cb8-39"><a href="#cb8-39" aria-hidden="true" tabindex="-1"></a>        fl700_lst.append(np.nan)</span>
<span id="cb8-40"><a href="#cb8-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-41"><a href="#cb8-41" aria-hidden="true" tabindex="-1"></a>  spec_df[<span class="st">'Chl_Fl'</span>] <span class="op">=</span> chl_fl_lst                             <span class="co"># Append the Chl_Fl to the dataframe.</span></span>
<span id="cb8-42"><a href="#cb8-42" aria-hidden="true" tabindex="-1"></a>  spec_df[<span class="st">'fl_700'</span>] <span class="op">=</span> fl700_lst</span>
<span id="cb8-43"><a href="#cb8-43" aria-hidden="true" tabindex="-1"></a>  <span class="bu">print</span>(<span class="ss">f'   </span><span class="sc">{</span>i<span class="sc">}</span><span class="ss"> of </span><span class="sc">{</span><span class="bu">len</span>(spec_df)<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb8-44"><a href="#cb8-44" aria-hidden="true" tabindex="-1"></a>  ofn <span class="op">=</span> hs.now_utc(fmt<span class="op">=</span><span class="st">'/content/%Y-%m</span><span class="sc">%d</span><span class="st">-%H%M%S-HABSpec-results.txt'</span>)</span>
<span id="cb8-45"><a href="#cb8-45" aria-hidden="true" tabindex="-1"></a>  spec_df.to_csv(ofn, float_format<span class="op">=</span><span class="st">'</span><span class="sc">%.6f</span><span class="st">'</span>, index<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb8-46"><a href="#cb8-46" aria-hidden="true" tabindex="-1"></a>  <span class="bu">print</span>(<span class="st">'</span><span class="ch">\n</span><span class="st">Processed data are in the "spec_df" dataframe.'</span>)</span>
<span id="cb8-47"><a href="#cb8-47" aria-hidden="true" tabindex="-1"></a>  <span class="bu">print</span>(<span class="ss">f'Results written to: </span><span class="sc">{</span>ofn<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb8-48"><a href="#cb8-48" aria-hidden="true" tabindex="-1"></a>  <span class="bu">print</span>(<span class="ss">f'</span><span class="sc">{</span>hs<span class="sc">.</span>now_utc()<span class="sc">}</span><span class="ss">: Completed.'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="plots-graphs-maps" class="level1">
<h1>Plots, Graphs, Maps</h1>
<section id="gps-plots-maps" class="level2">
<h2 class="anchored" data-anchor-id="gps-plots-maps">GPS Plots, Maps</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co">#@title Show just the GPS Track on a map { form-width: "30%" }</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="va">__name__</span> <span class="op">==</span> <span class="st">'__main__'</span>:</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  Gps_File_Name <span class="op">=</span> <span class="st">"/content/drive/MyDrive/Missions/2021-1208-HAB-Lake-Parker/2021-1208/all-gps.txt"</span> <span class="co">#@param {type:"string"}</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  mp <span class="op">=</span> <span class="st">"ESRI Imagery"</span> <span class="co">#@param ["ESRI Imagery", "Open Street Maps", "WorldMap" ]</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>  Track_Color <span class="op">=</span> <span class="st">"white"</span> <span class="co">#@param ["red", "green", "blue", "black", "white", "gray", "lightgray", "darkgray"]</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>  Point_Size <span class="op">=</span> <span class="fl">2.0</span> <span class="co">#@param [".1", ".25", ".5", ".75", "1.0", "1.5", "2.0", "3.0", "5.0", "10", "20"] {type:"raw"}</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>  <span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>  <span class="im">from</span> pathlib <span class="im">import</span> Path</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> <span class="kw">not</span> Path(<span class="st">'/usr/local/bin/pyproj'</span>).is_file():</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>    <span class="op">!</span>pip install pyproj</span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>  <span class="im">import</span> bokeh.io</span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>  bokeh.io.output_notebook()</span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>  <span class="im">import</span> bokeh.plotting</span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>  <span class="im">from</span> bokeh.plotting <span class="im">import</span> figure</span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>  <span class="im">from</span> bokeh.io <span class="im">import</span> output_notebook, show</span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>  <span class="im">from</span> bokeh.tile_providers <span class="im">import</span> get_provider, WIKIMEDIA, CARTODBPOSITRON, STAMEN_TERRAIN, STAMEN_TONER, ESRI_IMAGERY, OSM</span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>  <span class="im">from</span> pyproj <span class="im">import</span> Proj, transform</span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a>  <span class="im">import</span> warnings</span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a>  warnings.filterwarnings(<span class="st">"ignore"</span>)</span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a>  TOOLS <span class="op">=</span> <span class="st">"pan,wheel_zoom,box_zoom,reset, save, undo, redo, hover"</span></span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a>  TOOLTIPS <span class="op">=</span> [</span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a>      (<span class="st">"index"</span>, <span class="st">"$index"</span>)  <span class="co">#,</span></span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a>      <span class="co">#("(x,y)", "($x, $y)"),</span></span>
<span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a>      <span class="co">#("desc", "@desc"),</span></span>
<span id="cb9-30"><a href="#cb9-30" aria-hidden="true" tabindex="-1"></a>  ]</span>
<span id="cb9-31"><a href="#cb9-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-32"><a href="#cb9-32" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create a spectra obj. Functions to read the gps data files are in this class.</span></span>
<span id="cb9-33"><a href="#cb9-33" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> <span class="kw">not</span> <span class="st">'HyperSpec'</span> <span class="kw">in</span> <span class="bu">dir</span>():</span>
<span id="cb9-34"><a href="#cb9-34" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Can't find the HyperSpec class.  You need to run the Cell above: 'Load all local defs.'"</span>)</span>
<span id="cb9-35"><a href="#cb9-35" aria-hidden="true" tabindex="-1"></a>  <span class="cf">else</span>:</span>
<span id="cb9-36"><a href="#cb9-36" aria-hidden="true" tabindex="-1"></a>    hs <span class="op">=</span> HyperSpec()</span>
<span id="cb9-37"><a href="#cb9-37" aria-hidden="true" tabindex="-1"></a>    gps_df <span class="op">=</span> hs.read_gps_file_to_df(Gps_File_Name)</span>
<span id="cb9-38"><a href="#cb9-38" aria-hidden="true" tabindex="-1"></a>    screenProj <span class="op">=</span> Proj(init<span class="op">=</span><span class="st">'epsg:3857'</span>)     <span class="co"># </span></span>
<span id="cb9-39"><a href="#cb9-39" aria-hidden="true" tabindex="-1"></a>    wgs84Proj <span class="op">=</span> Proj(init<span class="op">=</span><span class="st">'epsg:4326'</span>)    <span class="co"># WGS-84</span></span>
<span id="cb9-40"><a href="#cb9-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-41"><a href="#cb9-41" aria-hidden="true" tabindex="-1"></a>    map_border <span class="op">=</span> <span class="fl">.1</span></span>
<span id="cb9-42"><a href="#cb9-42" aria-hidden="true" tabindex="-1"></a>    lat_min <span class="op">=</span> gps_df[<span class="st">'Lat'</span>].<span class="bu">min</span>() <span class="op">-</span> map_border</span>
<span id="cb9-43"><a href="#cb9-43" aria-hidden="true" tabindex="-1"></a>    lat_max <span class="op">=</span> gps_df[<span class="st">'Lat'</span>].<span class="bu">max</span>() <span class="op">+</span> map_border</span>
<span id="cb9-44"><a href="#cb9-44" aria-hidden="true" tabindex="-1"></a>    lon_min <span class="op">=</span> gps_df[<span class="st">'Lon'</span>].<span class="bu">min</span>() <span class="op">-</span> map_border</span>
<span id="cb9-45"><a href="#cb9-45" aria-hidden="true" tabindex="-1"></a>    lon_max <span class="op">=</span> gps_df[<span class="st">'Lon'</span>].<span class="bu">max</span>() <span class="op">+</span> map_border</span>
<span id="cb9-46"><a href="#cb9-46" aria-hidden="true" tabindex="-1"></a>    <span class="co"># print( lat_max, lat_min, lon_max,lon_min)</span></span>
<span id="cb9-47"><a href="#cb9-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-48"><a href="#cb9-48" aria-hidden="true" tabindex="-1"></a>    world_lon1, world_lat1 <span class="op">=</span> transform(wgs84Proj,screenProj,lon_min,lat_max)</span>
<span id="cb9-49"><a href="#cb9-49" aria-hidden="true" tabindex="-1"></a>    world_lon2, world_lat2 <span class="op">=</span> transform(wgs84Proj,screenProj,lon_max,lat_min)</span>
<span id="cb9-50"><a href="#cb9-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-51"><a href="#cb9-51" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="st">'gps_df'</span> <span class="kw">not</span> <span class="kw">in</span> <span class="bu">globals</span>():</span>
<span id="cb9-52"><a href="#cb9-52" aria-hidden="true" tabindex="-1"></a>      <span class="bu">print</span>(<span class="st">'</span><span class="ch">\n</span><span class="st">No gps_df dataframe is present.  You need to process some data to create a "gps_df" variable.'</span>)</span>
<span id="cb9-53"><a href="#cb9-53" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb9-54"><a href="#cb9-54" aria-hidden="true" tabindex="-1"></a>      gps_lats, gps_lons <span class="op">=</span> transform(wgs84Proj, screenProj, gps_df[<span class="st">'Lon'</span>], gps_df[<span class="st">'Lat'</span>])</span>
<span id="cb9-55"><a href="#cb9-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-56"><a href="#cb9-56" aria-hidden="true" tabindex="-1"></a>      <span class="co">#cartodb = get_provider(CARTODBPOSITRON)</span></span>
<span id="cb9-57"><a href="#cb9-57" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> mp <span class="op">==</span> <span class="st">"ESRI Imagery"</span>:</span>
<span id="cb9-58"><a href="#cb9-58" aria-hidden="true" tabindex="-1"></a>        cartodb <span class="op">=</span> get_provider(ESRI_IMAGERY)</span>
<span id="cb9-59"><a href="#cb9-59" aria-hidden="true" tabindex="-1"></a>      <span class="cf">elif</span> mp <span class="op">==</span> <span class="st">"WikiMedia"</span>:</span>
<span id="cb9-60"><a href="#cb9-60" aria-hidden="true" tabindex="-1"></a>        cartodb <span class="op">=</span> get_provider(WIKIMEDIA)</span>
<span id="cb9-61"><a href="#cb9-61" aria-hidden="true" tabindex="-1"></a>      <span class="cf">elif</span> mp <span class="op">==</span> <span class="st">"WorldMap"</span>:</span>
<span id="cb9-62"><a href="#cb9-62" aria-hidden="true" tabindex="-1"></a>        cartodb <span class="op">=</span> get_provider(CARTODBPOSITRON)</span>
<span id="cb9-63"><a href="#cb9-63" aria-hidden="true" tabindex="-1"></a>      <span class="cf">elif</span> mp <span class="op">==</span> <span class="st">"Open Street Maps"</span>:</span>
<span id="cb9-64"><a href="#cb9-64" aria-hidden="true" tabindex="-1"></a>        cartodb <span class="op">=</span> get_provider(OSM)</span>
<span id="cb9-65"><a href="#cb9-65" aria-hidden="true" tabindex="-1"></a>      <span class="cf">elif</span> mp <span class="op">==</span> <span class="st">"STAMEN_TERRAIN"</span>:</span>
<span id="cb9-66"><a href="#cb9-66" aria-hidden="true" tabindex="-1"></a>        cartodb <span class="op">=</span> STAMEN_TERRAIN</span>
<span id="cb9-67"><a href="#cb9-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-68"><a href="#cb9-68" aria-hidden="true" tabindex="-1"></a>      fig <span class="op">=</span> figure(title<span class="op">=</span>Gps_File_Name,</span>
<span id="cb9-69"><a href="#cb9-69" aria-hidden="true" tabindex="-1"></a>                  plot_width<span class="op">=</span><span class="dv">800</span>, plot_height<span class="op">=</span><span class="dv">800</span>,</span>
<span id="cb9-70"><a href="#cb9-70" aria-hidden="true" tabindex="-1"></a>                  tooltips<span class="op">=</span>TOOLTIPS, tools<span class="op">=</span>TOOLS,</span>
<span id="cb9-71"><a href="#cb9-71" aria-hidden="true" tabindex="-1"></a>                  x_range<span class="op">=</span>(world_lon1, world_lon2),</span>
<span id="cb9-72"><a href="#cb9-72" aria-hidden="true" tabindex="-1"></a>                  y_range<span class="op">=</span>(world_lat1, world_lat2),</span>
<span id="cb9-73"><a href="#cb9-73" aria-hidden="true" tabindex="-1"></a>                  x_axis_type<span class="op">=</span><span class="st">"mercator"</span>, y_axis_type<span class="op">=</span><span class="st">"mercator"</span>,</span>
<span id="cb9-74"><a href="#cb9-74" aria-hidden="true" tabindex="-1"></a>                  output_backend<span class="op">=</span><span class="st">"webgl"</span></span>
<span id="cb9-75"><a href="#cb9-75" aria-hidden="true" tabindex="-1"></a>                  )</span>
<span id="cb9-76"><a href="#cb9-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-77"><a href="#cb9-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-78"><a href="#cb9-78" aria-hidden="true" tabindex="-1"></a>      fig.add_tile(cartodb)</span>
<span id="cb9-79"><a href="#cb9-79" aria-hidden="true" tabindex="-1"></a>      fig.circle( y<span class="op">=</span>gps_lons, x<span class="op">=</span>gps_lats, size<span class="op">=</span>Point_Size, color<span class="op">=</span>Track_Color )</span>
<span id="cb9-80"><a href="#cb9-80" aria-hidden="true" tabindex="-1"></a>      show(fig)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co">#@title Show the GPS Track on a map with data results. { form-width: "30%" }</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="va">__name__</span> <span class="op">==</span> <span class="st">'__main__'</span>:</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  Gps_File_Name <span class="op">=</span> <span class="st">"/content/drive/MyDrive/Missions/2021-1208-HAB-Lake-Parker/2021-1208/all-gps.txt"</span> <span class="co">#@param {type:"string"}</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>  mp <span class="op">=</span> <span class="st">"ESRI Imagery"</span> <span class="co">#@param ["ESRI Imagery", "Open Street Maps", "WorldMap" ]</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>  Track_Color <span class="op">=</span> <span class="st">"red"</span> <span class="co">#@param ["red", "green", "blue", "black", "white", "gray", "lightgray", "darkgray"]</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>  Point_Size <span class="op">=</span> <span class="fl">.1</span> <span class="co">#@param [".1", ".25", ".5", ".75", "1.0", "1.5", "2.0", "3.0", "5.0", "10", "20"] {type:"raw"}</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>  Fl_Scale <span class="op">=</span>  <span class="fl">.3</span><span class="co">#@param {type:"number"}</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>  Show_Index <span class="op">=</span> <span class="va">True</span> <span class="co">#@param ["True", "False"] {type:"raw"}</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>  <span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>  <span class="im">from</span> pathlib <span class="im">import</span> Path</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> <span class="kw">not</span> Path(<span class="st">'/usr/local/bin/pyproj'</span>).is_file():</span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>    <span class="op">!</span>pip install pyproj</span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>  <span class="im">import</span> bokeh.io</span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>  bokeh.io.output_notebook()</span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>  <span class="im">import</span> bokeh.plotting</span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>  <span class="im">from</span> bokeh.plotting <span class="im">import</span> figure</span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a>  <span class="im">from</span> bokeh.io <span class="im">import</span> output_notebook, show</span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a>  <span class="im">from</span> bokeh.tile_providers <span class="im">import</span> get_provider, WIKIMEDIA, CARTODBPOSITRON, STAMEN_TERRAIN, STAMEN_TONER, ESRI_IMAGERY, OSM</span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a>  <span class="im">from</span> pyproj <span class="im">import</span> Proj, transform</span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a>  <span class="im">import</span> warnings</span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a>  warnings.filterwarnings(<span class="st">"ignore"</span>)</span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a>  TOOLS <span class="op">=</span> <span class="st">"pan,wheel_zoom,box_zoom,reset, save, undo, redo, hover"</span></span>
<span id="cb10-28"><a href="#cb10-28" aria-hidden="true" tabindex="-1"></a>  TOOLTIPS <span class="op">=</span> [</span>
<span id="cb10-29"><a href="#cb10-29" aria-hidden="true" tabindex="-1"></a>      (<span class="st">"index"</span>, <span class="st">"$index"</span>)  <span class="co">#,</span></span>
<span id="cb10-30"><a href="#cb10-30" aria-hidden="true" tabindex="-1"></a>      <span class="co">#("(x,y)", "($x, $y)"),</span></span>
<span id="cb10-31"><a href="#cb10-31" aria-hidden="true" tabindex="-1"></a>      <span class="co">#("desc", "@desc"),</span></span>
<span id="cb10-32"><a href="#cb10-32" aria-hidden="true" tabindex="-1"></a>  ]</span>
<span id="cb10-33"><a href="#cb10-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-34"><a href="#cb10-34" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create a spectra obj</span></span>
<span id="cb10-35"><a href="#cb10-35" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> <span class="kw">not</span> <span class="st">'HyperSpec'</span> <span class="kw">in</span> <span class="bu">dir</span>():</span>
<span id="cb10-36"><a href="#cb10-36" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Can't find the HyperSpec class.  You need to run the Cell above: 'Load all local defs.'"</span>)</span>
<span id="cb10-37"><a href="#cb10-37" aria-hidden="true" tabindex="-1"></a>  <span class="cf">else</span>:</span>
<span id="cb10-38"><a href="#cb10-38" aria-hidden="true" tabindex="-1"></a>    hs <span class="op">=</span> HyperSpec()</span>
<span id="cb10-39"><a href="#cb10-39" aria-hidden="true" tabindex="-1"></a>    gps_df <span class="op">=</span> hs.read_gps_file_to_df(Gps_File_Name)</span>
<span id="cb10-40"><a href="#cb10-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-41"><a href="#cb10-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-42"><a href="#cb10-42" aria-hidden="true" tabindex="-1"></a>  screenProj <span class="op">=</span> Proj(init<span class="op">=</span><span class="st">'epsg:3857'</span>)     <span class="co"># </span></span>
<span id="cb10-43"><a href="#cb10-43" aria-hidden="true" tabindex="-1"></a>  wgs84Proj <span class="op">=</span> Proj(init<span class="op">=</span><span class="st">'epsg:4326'</span>)    <span class="co"># WGS-84</span></span>
<span id="cb10-44"><a href="#cb10-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-45"><a href="#cb10-45" aria-hidden="true" tabindex="-1"></a>  map_border <span class="op">=</span> <span class="fl">.1</span></span>
<span id="cb10-46"><a href="#cb10-46" aria-hidden="true" tabindex="-1"></a>  lat_min <span class="op">=</span> gps_df[<span class="st">'Lat'</span>].<span class="bu">min</span>() <span class="op">-</span> map_border</span>
<span id="cb10-47"><a href="#cb10-47" aria-hidden="true" tabindex="-1"></a>  lat_max <span class="op">=</span> gps_df[<span class="st">'Lat'</span>].<span class="bu">max</span>() <span class="op">+</span> map_border</span>
<span id="cb10-48"><a href="#cb10-48" aria-hidden="true" tabindex="-1"></a>  lon_min <span class="op">=</span> gps_df[<span class="st">'Lon'</span>].<span class="bu">min</span>() <span class="op">-</span> map_border</span>
<span id="cb10-49"><a href="#cb10-49" aria-hidden="true" tabindex="-1"></a>  lon_max <span class="op">=</span> gps_df[<span class="st">'Lon'</span>].<span class="bu">max</span>() <span class="op">+</span> map_border</span>
<span id="cb10-50"><a href="#cb10-50" aria-hidden="true" tabindex="-1"></a>  <span class="co"># print( lat_max, lat_min, lon_max,lon_min)</span></span>
<span id="cb10-51"><a href="#cb10-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-52"><a href="#cb10-52" aria-hidden="true" tabindex="-1"></a>  world_lon1, world_lat1 <span class="op">=</span> transform(wgs84Proj,screenProj,lon_min,lat_max)</span>
<span id="cb10-53"><a href="#cb10-53" aria-hidden="true" tabindex="-1"></a>  world_lon2, world_lat2 <span class="op">=</span> transform(wgs84Proj,screenProj,lon_max,lat_min)</span>
<span id="cb10-54"><a href="#cb10-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-55"><a href="#cb10-55" aria-hidden="true" tabindex="-1"></a>  <span class="co">#gps_lats, gps_lons = transform(wgs84Proj, screenProj, gps_df['Lon'], gps_df['Lat'])</span></span>
<span id="cb10-56"><a href="#cb10-56" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> <span class="st">'spec_df'</span> <span class="kw">not</span> <span class="kw">in</span> <span class="bu">globals</span>():</span>
<span id="cb10-57"><a href="#cb10-57" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">'</span><span class="ch">\n</span><span class="st">No spec_df dataframe is present.  You need to process some data to create a "spec_df" variable.'</span>)</span>
<span id="cb10-58"><a href="#cb10-58" aria-hidden="true" tabindex="-1"></a>  <span class="cf">else</span>:</span>
<span id="cb10-59"><a href="#cb10-59" aria-hidden="true" tabindex="-1"></a>    gps_lats, gps_lons <span class="op">=</span> transform(wgs84Proj, screenProj, spec_df[<span class="st">'Lon'</span>], spec_df[<span class="st">'Lat'</span>])</span>
<span id="cb10-60"><a href="#cb10-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-61"><a href="#cb10-61" aria-hidden="true" tabindex="-1"></a>    <span class="co">#cartodb = get_provider(CARTODBPOSITRON)</span></span>
<span id="cb10-62"><a href="#cb10-62" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> mp <span class="op">==</span> <span class="st">"ESRI Imagery"</span>:</span>
<span id="cb10-63"><a href="#cb10-63" aria-hidden="true" tabindex="-1"></a>      cartodb <span class="op">=</span> get_provider(ESRI_IMAGERY)</span>
<span id="cb10-64"><a href="#cb10-64" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> mp <span class="op">==</span> <span class="st">"WikiMedia"</span>:</span>
<span id="cb10-65"><a href="#cb10-65" aria-hidden="true" tabindex="-1"></a>      cartodb <span class="op">=</span> get_provider(WIKIMEDIA)</span>
<span id="cb10-66"><a href="#cb10-66" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> mp <span class="op">==</span> <span class="st">"WorldMap"</span>:</span>
<span id="cb10-67"><a href="#cb10-67" aria-hidden="true" tabindex="-1"></a>      cartodb <span class="op">=</span> get_provider(CARTODBPOSITRON)</span>
<span id="cb10-68"><a href="#cb10-68" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> mp <span class="op">==</span> <span class="st">"Open Street Maps"</span>:</span>
<span id="cb10-69"><a href="#cb10-69" aria-hidden="true" tabindex="-1"></a>      cartodb <span class="op">=</span> get_provider(OSM)</span>
<span id="cb10-70"><a href="#cb10-70" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> mp <span class="op">==</span> <span class="st">"STAMEN_TERRAIN"</span>:</span>
<span id="cb10-71"><a href="#cb10-71" aria-hidden="true" tabindex="-1"></a>      cartodb <span class="op">=</span> STAMEN_TERRAIN</span>
<span id="cb10-72"><a href="#cb10-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-73"><a href="#cb10-73" aria-hidden="true" tabindex="-1"></a>    fig <span class="op">=</span> figure(title<span class="op">=</span>Gps_File_Name,</span>
<span id="cb10-74"><a href="#cb10-74" aria-hidden="true" tabindex="-1"></a>                plot_width<span class="op">=</span><span class="dv">800</span>, plot_height<span class="op">=</span><span class="dv">800</span>,</span>
<span id="cb10-75"><a href="#cb10-75" aria-hidden="true" tabindex="-1"></a>                tooltips<span class="op">=</span>TOOLTIPS, tools<span class="op">=</span>TOOLS,</span>
<span id="cb10-76"><a href="#cb10-76" aria-hidden="true" tabindex="-1"></a>                x_range<span class="op">=</span>(world_lon1, world_lon2),</span>
<span id="cb10-77"><a href="#cb10-77" aria-hidden="true" tabindex="-1"></a>                y_range<span class="op">=</span>(world_lat1, world_lat2),</span>
<span id="cb10-78"><a href="#cb10-78" aria-hidden="true" tabindex="-1"></a>                x_axis_type<span class="op">=</span><span class="st">"mercator"</span>, y_axis_type<span class="op">=</span><span class="st">"mercator"</span>,</span>
<span id="cb10-79"><a href="#cb10-79" aria-hidden="true" tabindex="-1"></a>                output_backend<span class="op">=</span><span class="st">"webgl"</span></span>
<span id="cb10-80"><a href="#cb10-80" aria-hidden="true" tabindex="-1"></a>                )</span>
<span id="cb10-81"><a href="#cb10-81" aria-hidden="true" tabindex="-1"></a>    <span class="im">from</span> bokeh.models <span class="im">import</span> Title</span>
<span id="cb10-82"><a href="#cb10-82" aria-hidden="true" tabindex="-1"></a>    fig.add_layout( Title(text<span class="op">=</span><span class="ss">f'Data Source: </span><span class="sc">{</span>Root_Data_Path<span class="sc">}</span><span class="ss">'</span>, align<span class="op">=</span><span class="st">"center"</span>), <span class="st">"below"</span>)</span>
<span id="cb10-83"><a href="#cb10-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-84"><a href="#cb10-84" aria-hidden="true" tabindex="-1"></a>    fig.add_tile(cartodb)</span>
<span id="cb10-85"><a href="#cb10-85" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-86"><a href="#cb10-86" aria-hidden="true" tabindex="-1"></a>    min_chl <span class="op">=</span> spec_df[<span class="st">'Chl_Fl'</span>].<span class="bu">min</span>() <span class="op">+</span> <span class="fl">0.001</span></span>
<span id="cb10-87"><a href="#cb10-87" aria-hidden="true" tabindex="-1"></a>    min_700 <span class="op">=</span> spec_df[<span class="st">'fl_700'</span>].<span class="bu">min</span>() <span class="op">+</span> <span class="fl">0.001</span></span>
<span id="cb10-88"><a href="#cb10-88" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> Show_Index:</span>
<span id="cb10-89"><a href="#cb10-89" aria-hidden="true" tabindex="-1"></a>      fig.circle(y<span class="op">=</span>gps_lons, x<span class="op">=</span>gps_lats, legend_label<span class="op">=</span><span class="st">""</span>, color<span class="op">=</span><span class="st">'Yellow'</span>, size<span class="op">=</span><span class="dv">4</span> )</span>
<span id="cb10-90"><a href="#cb10-90" aria-hidden="true" tabindex="-1"></a>    fig.ray(y<span class="op">=</span>gps_lons, x<span class="op">=</span>gps_lats, length<span class="op">=</span>(spec_df[<span class="st">'fl_700'</span>]<span class="op">-</span>min_700)<span class="op">*</span>Fl_Scale, angle_units<span class="op">=</span><span class="st">'deg'</span>, angle<span class="op">=-</span>spec_df[<span class="st">'Course'</span>], </span>
<span id="cb10-91"><a href="#cb10-91" aria-hidden="true" tabindex="-1"></a>            line_color<span class="op">=</span><span class="st">'Orange'</span>, line_width<span class="op">=</span><span class="dv">3</span>, legend_label<span class="op">=</span><span class="st">"700nm"</span>)</span>
<span id="cb10-92"><a href="#cb10-92" aria-hidden="true" tabindex="-1"></a>    fig.ray(y<span class="op">=</span>gps_lons, x<span class="op">=</span>gps_lats, length<span class="op">=</span>(spec_df[<span class="st">'Chl_Fl'</span>]<span class="op">-</span>min_chl)<span class="op">*</span>Fl_Scale, angle_units<span class="op">=</span><span class="st">'deg'</span>, angle<span class="op">=-</span>spec_df[<span class="st">'Course'</span>]<span class="op">+</span><span class="fl">180.0</span>,</span>
<span id="cb10-93"><a href="#cb10-93" aria-hidden="true" tabindex="-1"></a>            line_color<span class="op">=</span><span class="st">'Red'</span>, line_width<span class="op">=</span><span class="dv">3</span>, legend_label<span class="op">=</span><span class="st">"683nm"</span>)</span>
<span id="cb10-94"><a href="#cb10-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-95"><a href="#cb10-95" aria-hidden="true" tabindex="-1"></a>    show(fig)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="plot-a-single-json-spectra-file-v2." class="level2">
<h2 class="anchored" data-anchor-id="plot-a-single-json-spectra-file-v2.">Plot a single json spectra file v2.</h2>
<p>See <a href="https://en.wikipedia.org/wiki/Fraunhofer_lines">Fraunhofer lines</a> for absorption lines that can be used for wavelength calibration.</p>
<p>Also See: <a href="https://physics.nist.gov/PhysRefData/Handbook/Tables/mercurytable2.htm">Strong Lines of Mercury ( Hg )</a></p>
<section id="plot-settings." class="level3">
<h3 class="anchored" data-anchor-id="plot-settings.">Plot Settings.</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co">#@title Plot Spectra Settings { form-width: "30%", display-mode: "form"}</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="va">__name__</span> <span class="op">==</span> <span class="st">'__main__'</span>:</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>  Plot_Spectra_Settings <span class="op">=</span> <span class="va">True</span>    <span class="co"># used to indicate this cell has been run.</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>  Spectra_Plot_Style <span class="op">=</span> <span class="st">"Lines"</span> <span class="co">#@param ["Lines", "Lines &amp; Points", "Points"]</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>  Point_Size <span class="op">=</span> <span class="fl">5.0</span> <span class="co">#@param [".1", ".25", ".5", ".75", "1.0", "1.5", "2.0", "3.0", "5.0"] {type:"raw"}</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>  Line_Color  <span class="op">=</span> <span class="st">"blue"</span> <span class="co">#@param ["red", "green", "blue", "black", "white", "gray", "lightgray", "darkgray"]</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>  Point_Color <span class="op">=</span> <span class="st">"green"</span> <span class="co">#@param ["red", "green", "blue", "black", "white", "gray", "lightgray", "darkgray"]</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>  X_Axis <span class="op">=</span> <span class="st">"Wavelength (nm)"</span> <span class="co">#@param ["Wavelength (nm)", "Pixels"]</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>  Remove_Bias <span class="op">=</span> <span class="va">True</span> <span class="co">#@param ["True", "False"] {type:"raw"}</span></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>  Y_Axis <span class="op">=</span> <span class="st">"Average"</span> <span class="co">#@param ["Average", "Sum Total"]</span></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>  Show_Calibration_Lines <span class="op">=</span> <span class="st">"Fraunhofer Lines"</span> <span class="co">#@param ["Fluorescent Light Lines", "Fraunhofer Lines", "None"]</span></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>  Show_RGB <span class="op">=</span> <span class="va">True</span> <span class="co">#@param ["True", "False"] {type:"raw"}</span></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>  <span class="bu">print</span>(<span class="st">'Spectral Plot Setting:</span><span class="ch">\n</span><span class="st">'</span></span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>  <span class="ss">f'    Spectra_Plot_Style: </span><span class="sc">{</span>Spectra_Plot_Style<span class="sc">}</span><span class="ch">\n</span><span class="ss">'</span></span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>  <span class="ss">f'            Point_Size: </span><span class="sc">{</span>Point_Size<span class="sc">}</span><span class="ss">               Line_Color:</span><span class="sc">{</span>Line_Color<span class="sc">}</span><span class="ss">   Point_Color:</span><span class="sc">{</span>Point_Color<span class="sc">}</span><span class="ch">\n</span><span class="ss">'</span></span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>  <span class="ss">f'                X_Axis: </span><span class="sc">{</span>X_Axis<span class="sc">}</span><span class="ss">  Remove_Bias:</span><span class="sc">{</span>Remove_Bias<span class="sc">}</span><span class="ss">        Y_Axis:</span><span class="sc">{</span>Y_Axis<span class="sc">}</span><span class="ch">\n</span><span class="ss">'</span></span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>  <span class="ss">f'Show_Calibration_Lines: </span><span class="sc">{</span>Show_Calibration_Lines<span class="sc">}</span><span class="ss">    Show_RGB:</span><span class="sc">{</span>Show_RGB<span class="sc">}</span><span class="ch">\n</span><span class="ss">'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="plot-a-single-spectra-and-nearby-photo" class="level3">
<h3 class="anchored" data-anchor-id="plot-a-single-spectra-and-nearby-photo">Plot a single Spectra and nearby Photo</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co">#@title Plot a Spectra File using above settings{ form-width: "30%" }</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="va">__name__</span> <span class="op">==</span> <span class="st">'__main__'</span>:</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  Spectra_File_Name <span class="op">=</span> <span class="st">"/content/drive/MyDrive/Missions/2021-1208-HAB-Lake-Parker/2021-1208/183807/hab_spectra/2021-1208-184034-847363-spec.json"</span> <span class="co">#@param {type:"string"}</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>  Index_Or_File <span class="op">=</span> <span class="st">"File"</span> <span class="co">#@param ["Index", "File"]</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>  File_Index <span class="op">=</span>  <span class="dv">550</span><span class="co">#@param {type:"integer"}</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>  <span class="im">import</span> os</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>  <span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>  <span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>  <span class="im">import</span> bokeh.io</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>  <span class="im">from</span> bokeh.plotting <span class="im">import</span> figure, show</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>  <span class="im">from</span> bokeh.io <span class="im">import</span> output_notebook, show</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>  <span class="im">from</span> bokeh.layouts <span class="im">import</span> row</span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>  bokeh.io.output_notebook()</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> Index_Or_File <span class="op">==</span> <span class="st">'Index'</span>:</span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>    Spectra_File_Name <span class="op">=</span> spec_df[<span class="st">'Json_spec'</span>].iloc[File_Index]</span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>  <span class="cf">else</span>:</span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">pass</span></span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create a spectra obj</span></span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> <span class="kw">not</span> <span class="st">'HyperSpec'</span> <span class="kw">in</span> <span class="bu">dir</span>():</span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Can't find the HyperSpec class.  You need to run the Cell above: 'Load all local defs.'"</span>)</span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a>  <span class="cf">else</span>:</span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> <span class="st">'Plot_Spectra_Settings'</span> <span class="kw">in</span> <span class="bu">globals</span>():</span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a>      <span class="bu">print</span>(<span class="st">"You must first run the cell: 'Plot Spectra Settings'  to load the plot settings.  "</span>)</span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a>      hs <span class="op">=</span> HyperSpec()</span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Use a json spectra to initialize things.</span></span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a>      hs.configure_json_spectra(Spectra_File_Name)</span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-34"><a href="#cb12-34" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Calibrate the spectra for wavelength in nanometers</span></span>
<span id="cb12-35"><a href="#cb12-35" aria-hidden="true" tabindex="-1"></a>      hs.calibrate_using_2_wavelengths(pixel0<span class="op">=</span><span class="dv">73</span>, wavelength0<span class="op">=</span><span class="fl">430.774</span>, pixel1<span class="op">=</span><span class="dv">941</span>, wavelength1<span class="op">=</span><span class="fl">759.370</span> )</span>
<span id="cb12-36"><a href="#cb12-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-37"><a href="#cb12-37" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Read a spectra array from a file into s</span></span>
<span id="cb12-38"><a href="#cb12-38" aria-hidden="true" tabindex="-1"></a>      y <span class="op">=</span> hs.read_spectra(Spectra_File_Name, </span>
<span id="cb12-39"><a href="#cb12-39" aria-hidden="true" tabindex="-1"></a>                          remove_bias <span class="op">=</span> Remove_Bias,</span>
<span id="cb12-40"><a href="#cb12-40" aria-hidden="true" tabindex="-1"></a>                          y_average <span class="op">=</span> <span class="va">True</span> <span class="cf">if</span> Y_Axis <span class="op">==</span> <span class="st">'Average'</span> <span class="cf">else</span> <span class="va">False</span></span>
<span id="cb12-41"><a href="#cb12-41" aria-hidden="true" tabindex="-1"></a>                          )</span>
<span id="cb12-42"><a href="#cb12-42" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb12-43"><a href="#cb12-43" aria-hidden="true" tabindex="-1"></a>      y_max <span class="op">=</span> y.<span class="bu">max</span>()</span>
<span id="cb12-44"><a href="#cb12-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-45"><a href="#cb12-45" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Setup X-Axis as pixel location or wavelength</span></span>
<span id="cb12-46"><a href="#cb12-46" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> X_Axis <span class="op">==</span> <span class="st">"Wavelength (nm)"</span>:</span>
<span id="cb12-47"><a href="#cb12-47" aria-hidden="true" tabindex="-1"></a>        x <span class="op">=</span> hs.wavelengths</span>
<span id="cb12-48"><a href="#cb12-48" aria-hidden="true" tabindex="-1"></a>      <span class="cf">else</span>:</span>
<span id="cb12-49"><a href="#cb12-49" aria-hidden="true" tabindex="-1"></a>        x <span class="op">=</span> hs.Xpixels</span>
<span id="cb12-50"><a href="#cb12-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-51"><a href="#cb12-51" aria-hidden="true" tabindex="-1"></a>      TOOLS <span class="op">=</span> <span class="st">"pan,wheel_zoom,box_zoom,reset, save, undo, redo, hover"</span></span>
<span id="cb12-52"><a href="#cb12-52" aria-hidden="true" tabindex="-1"></a>      TOOLTIPS <span class="op">=</span> [</span>
<span id="cb12-53"><a href="#cb12-53" aria-hidden="true" tabindex="-1"></a>          (<span class="st">"index"</span>, <span class="st">"$index"</span>),</span>
<span id="cb12-54"><a href="#cb12-54" aria-hidden="true" tabindex="-1"></a>          (<span class="st">"(x,y)"</span>, <span class="st">"($x, $y)"</span>),</span>
<span id="cb12-55"><a href="#cb12-55" aria-hidden="true" tabindex="-1"></a>          (<span class="st">"desc"</span>, <span class="st">"@desc"</span>),</span>
<span id="cb12-56"><a href="#cb12-56" aria-hidden="true" tabindex="-1"></a>      ]</span>
<span id="cb12-57"><a href="#cb12-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-58"><a href="#cb12-58" aria-hidden="true" tabindex="-1"></a>      ttl <span class="op">=</span> <span class="ss">f'Spectral Flie:  </span><span class="sc">{</span>os<span class="sc">.</span>path<span class="sc">.</span>split(Spectra_File_Name)[<span class="dv">1</span>]<span class="sc">}</span><span class="ss">'</span></span>
<span id="cb12-59"><a href="#cb12-59" aria-hidden="true" tabindex="-1"></a>      spec_fig <span class="op">=</span> figure(title<span class="op">=</span>ttl, </span>
<span id="cb12-60"><a href="#cb12-60" aria-hidden="true" tabindex="-1"></a>                        x_axis_label<span class="op">=</span>X_Axis, </span>
<span id="cb12-61"><a href="#cb12-61" aria-hidden="true" tabindex="-1"></a>                        tooltips<span class="op">=</span>TOOLTIPS, tools<span class="op">=</span>TOOLS, </span>
<span id="cb12-62"><a href="#cb12-62" aria-hidden="true" tabindex="-1"></a>                        y_axis_label<span class="op">=</span><span class="st">'Relative Digital Counts'</span>, </span>
<span id="cb12-63"><a href="#cb12-63" aria-hidden="true" tabindex="-1"></a>                        width<span class="op">=</span><span class="dv">1000</span>, height<span class="op">=</span><span class="dv">400</span>,</span>
<span id="cb12-64"><a href="#cb12-64" aria-hidden="true" tabindex="-1"></a>                        output_backend<span class="op">=</span><span class="st">"webgl"</span></span>
<span id="cb12-65"><a href="#cb12-65" aria-hidden="true" tabindex="-1"></a>                        )</span>
<span id="cb12-66"><a href="#cb12-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-67"><a href="#cb12-67" aria-hidden="true" tabindex="-1"></a>      spec_fig.title.text_font_size<span class="op">=</span><span class="st">'24px'</span></span>
<span id="cb12-68"><a href="#cb12-68" aria-hidden="true" tabindex="-1"></a>      spec_fig.xaxis.axis_label_text_font_size <span class="op">=</span> <span class="st">'24pt'</span></span>
<span id="cb12-69"><a href="#cb12-69" aria-hidden="true" tabindex="-1"></a>      spec_fig.xaxis.ticker.num_minor_ticks <span class="op">=</span> <span class="dv">5</span></span>
<span id="cb12-70"><a href="#cb12-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-71"><a href="#cb12-71" aria-hidden="true" tabindex="-1"></a>      spec_fig.xaxis.ticker.desired_num_ticks <span class="op">=</span> <span class="dv">10</span></span>
<span id="cb12-72"><a href="#cb12-72" aria-hidden="true" tabindex="-1"></a>      spec_fig.xaxis.major_label_text_font_size <span class="op">=</span> <span class="st">"18pt"</span></span>
<span id="cb12-73"><a href="#cb12-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-74"><a href="#cb12-74" aria-hidden="true" tabindex="-1"></a>      <span class="co">#hover_tool = HoverTool(tooltips=[</span></span>
<span id="cb12-75"><a href="#cb12-75" aria-hidden="true" tabindex="-1"></a>      <span class="co">#            ('Value', '$y'),</span></span>
<span id="cb12-76"><a href="#cb12-76" aria-hidden="true" tabindex="-1"></a>      <span class="co">#            ('Date', '@date_readable') ], renderers=[line] )</span></span>
<span id="cb12-77"><a href="#cb12-77" aria-hidden="true" tabindex="-1"></a>      <span class="co">#self.plot.tools.append(hover_tool)</span></span>
<span id="cb12-78"><a href="#cb12-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-79"><a href="#cb12-79" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> Show_Calibration_Lines <span class="op">==</span> <span class="st">"Fraunhofer Lines"</span>:</span>
<span id="cb12-80"><a href="#cb12-80" aria-hidden="true" tabindex="-1"></a>        cal_src <span class="op">=</span> hs.Fraunhofer_lines</span>
<span id="cb12-81"><a href="#cb12-81" aria-hidden="true" tabindex="-1"></a>        cal_lbl <span class="op">=</span> <span class="st">"Fraunhofer Lines"</span></span>
<span id="cb12-82"><a href="#cb12-82" aria-hidden="true" tabindex="-1"></a>      <span class="cf">elif</span> Show_Calibration_Lines <span class="op">==</span> <span class="st">"Fluorescent Light Lines"</span>:</span>
<span id="cb12-83"><a href="#cb12-83" aria-hidden="true" tabindex="-1"></a>        cal_src <span class="op">=</span> hs.HG_lines</span>
<span id="cb12-84"><a href="#cb12-84" aria-hidden="true" tabindex="-1"></a>        cal_lbl <span class="op">=</span> <span class="st">"Fluorescent Light Lines"</span></span>
<span id="cb12-85"><a href="#cb12-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-86"><a href="#cb12-86" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> Show_Calibration_Lines <span class="op">!=</span> <span class="st">'None'</span>:</span>
<span id="cb12-87"><a href="#cb12-87" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> frl <span class="kw">in</span> cal_src:</span>
<span id="cb12-88"><a href="#cb12-88" aria-hidden="true" tabindex="-1"></a>          xc <span class="op">=</span> cal_src[frl][<span class="dv">1</span>]</span>
<span id="cb12-89"><a href="#cb12-89" aria-hidden="true" tabindex="-1"></a>          spec_fig.line([xc,xc],[<span class="dv">0</span>,y_max], legend_label<span class="op">=</span>cal_lbl, line_width<span class="op">=</span><span class="dv">2</span>, color<span class="op">=</span><span class="st">'LightGray'</span>)</span>
<span id="cb12-90"><a href="#cb12-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-91"><a href="#cb12-91" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> Spectra_Plot_Style <span class="op">==</span> <span class="st">"Lines"</span> <span class="kw">or</span> Spectra_Plot_Style <span class="op">==</span> <span class="st">"Lines &amp; Points"</span>:</span>
<span id="cb12-92"><a href="#cb12-92" aria-hidden="true" tabindex="-1"></a>        spec_fig.line(x,y, legend_label<span class="op">=</span><span class="st">"Down Looking Spectra"</span>, line_width<span class="op">=</span><span class="dv">2</span>, color<span class="op">=</span>Line_Color)</span>
<span id="cb12-93"><a href="#cb12-93" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> Spectra_Plot_Style <span class="op">==</span> <span class="st">"Points"</span> <span class="kw">or</span> Spectra_Plot_Style <span class="op">==</span> <span class="st">"Lines &amp; Points"</span>:</span>
<span id="cb12-94"><a href="#cb12-94" aria-hidden="true" tabindex="-1"></a>        spec_fig.circle(x,y, size<span class="op">=</span>Point_Size, hover_color<span class="op">=</span><span class="st">'white'</span>, hover_alpha<span class="op">=</span><span class="fl">0.5</span>, color<span class="op">=</span>Point_Color)</span>
<span id="cb12-95"><a href="#cb12-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-96"><a href="#cb12-96" aria-hidden="true" tabindex="-1"></a>      show(spec_fig)</span>
<span id="cb12-97"><a href="#cb12-97" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Show nearby RGB image.</span></span>
<span id="cb12-98"><a href="#cb12-98" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> Show_RGB <span class="op">==</span> <span class="va">True</span>:</span>
<span id="cb12-99"><a href="#cb12-99" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb12-100"><a href="#cb12-100" aria-hidden="true" tabindex="-1"></a>          show_RGB_at_spec( Spectra_File_Name )</span>
<span id="cb12-101"><a href="#cb12-101" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span>:</span>
<span id="cb12-102"><a href="#cb12-102" aria-hidden="true" tabindex="-1"></a>          <span class="bu">print</span>(<span class="st">'RGB Photo not found.'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="plot-animated-spectra-and-photos-along-a-selected-flightline." class="level2">
<h2 class="anchored" data-anchor-id="plot-animated-spectra-and-photos-along-a-selected-flightline.">Plot Animated spectra and photos along a selected flightline.</h2>
<section id="animate-spectra-from-a-flightline" class="level3">
<h3 class="anchored" data-anchor-id="animate-spectra-from-a-flightline">Animate Spectra from a flightline</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co">#@title Animate a flight line of spectra { form-width: "30%" }</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="va">__name__</span> <span class="op">==</span> <span class="st">'__main__'</span>:</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>  <span class="im">from</span> IPython.display <span class="im">import</span> clear_output</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>  <span class="im">import</span> os</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>  <span class="co">#from   matplotlib import rc</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>  <span class="im">from</span>   matplotlib <span class="im">import</span> pyplot <span class="im">as</span> plt</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>  <span class="im">import</span> matplotlib <span class="im">as</span> mpl</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>  <span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>  <span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>  <span class="im">import</span> warnings</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>  warnings.filterwarnings(<span class="st">"ignore"</span>)</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>  <span class="im">from</span> matplotlib.ticker <span class="im">import</span> (MultipleLocator, AutoMinorLocator)</span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>  <span class="co"># /content/drive/MyDrive/Missions/2021-0717-HAB-pie/165347   Lots of fl.</span></span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a>  <span class="co">#Spectra_File_Name = "/content/drive/MyDrive/Missions/2021-0717-HAB-pie/161618/hab_spectra/2021-0717-161618-720442-spec.json" #@param {type:"string"}</span></span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a>  Flight_Line_Dir <span class="op">=</span> <span class="st">"/content/drive/MyDrive/Missions/2021-1208-HAB-Lake-Parker/2021-1208/190829"</span> <span class="co">#@param {type:"string"}</span></span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a>  X_Axis <span class="op">=</span> <span class="st">"Wavelength (nm)"</span> <span class="co">#@param ["Wavelength (nm)", "Pixels"]</span></span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a>  Plot_Fill <span class="op">=</span> <span class="st">"Area Fill"</span> <span class="co">#@param ["Area Fill", "Line Only"]</span></span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-24"><a href="#cb13-24" aria-hidden="true" tabindex="-1"></a>  fp <span class="op">=</span> Flight_Line_Dir<span class="op">+</span><span class="st">"/hab_spectra/"</span></span>
<span id="cb13-25"><a href="#cb13-25" aria-hidden="true" tabindex="-1"></a>  l <span class="op">=</span> os.listdir(fp)</span>
<span id="cb13-26"><a href="#cb13-26" aria-hidden="true" tabindex="-1"></a>  spec <span class="op">=</span> pd.read_json(path_or_buf <span class="op">=</span>fp<span class="op">+</span> l[<span class="dv">0</span>])</span>
<span id="cb13-27"><a href="#cb13-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-28"><a href="#cb13-28" aria-hidden="true" tabindex="-1"></a>  <span class="co">#spec = pd.read_json(path_or_buf =Spectra_File_Name)</span></span>
<span id="cb13-29"><a href="#cb13-29" aria-hidden="true" tabindex="-1"></a>  y <span class="op">=</span> np.array(spec[<span class="st">'hab_spec'</span>].spectra) <span class="op">/</span> <span class="fl">800.0</span></span>
<span id="cb13-30"><a href="#cb13-30" aria-hidden="true" tabindex="-1"></a>  y <span class="op">=</span> y <span class="op">-</span> y.<span class="bu">min</span>()</span>
<span id="cb13-31"><a href="#cb13-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-32"><a href="#cb13-32" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Setup X-Axis as pixel location or wavelength</span></span>
<span id="cb13-33"><a href="#cb13-33" aria-hidden="true" tabindex="-1"></a>  x_pix <span class="op">=</span> np.arange(<span class="dv">0</span>,y.size ) </span>
<span id="cb13-34"><a href="#cb13-34" aria-hidden="true" tabindex="-1"></a>  w <span class="op">=</span> <span class="dv">400</span> <span class="op">+</span> x_pix <span class="op">*</span> ((<span class="dv">765</span><span class="op">-</span><span class="dv">400</span>)<span class="op">/</span><span class="dv">944</span>)</span>
<span id="cb13-35"><a href="#cb13-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-36"><a href="#cb13-36" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> X_Axis <span class="op">==</span> <span class="st">"Wavelength (nm)"</span>:</span>
<span id="cb13-37"><a href="#cb13-37" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> w</span>
<span id="cb13-38"><a href="#cb13-38" aria-hidden="true" tabindex="-1"></a>  <span class="cf">else</span>:</span>
<span id="cb13-39"><a href="#cb13-39" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> x_pix</span>
<span id="cb13-40"><a href="#cb13-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-41"><a href="#cb13-41" aria-hidden="true" tabindex="-1"></a>  cc <span class="op">=</span> <span class="st">'blue'</span></span>
<span id="cb13-42"><a href="#cb13-42" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> xx <span class="kw">in</span> l:</span>
<span id="cb13-43"><a href="#cb13-43" aria-hidden="true" tabindex="-1"></a>      sfn <span class="op">=</span> fp<span class="op">+</span>xx</span>
<span id="cb13-44"><a href="#cb13-44" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Show nearby RGB image.</span></span>
<span id="cb13-45"><a href="#cb13-45" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> Show_RGB <span class="op">==</span> <span class="va">True</span>:</span>
<span id="cb13-46"><a href="#cb13-46" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb13-47"><a href="#cb13-47" aria-hidden="true" tabindex="-1"></a>          show_RGB_at_spec( sfn )</span>
<span id="cb13-48"><a href="#cb13-48" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span>:</span>
<span id="cb13-49"><a href="#cb13-49" aria-hidden="true" tabindex="-1"></a>          <span class="cf">pass</span></span>
<span id="cb13-50"><a href="#cb13-50" aria-hidden="true" tabindex="-1"></a>      spec <span class="op">=</span> pd.read_json(path_or_buf <span class="op">=</span> sfn )</span>
<span id="cb13-51"><a href="#cb13-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-52"><a href="#cb13-52" aria-hidden="true" tabindex="-1"></a>      y <span class="op">=</span> np.array(spec[<span class="st">'hab_spec'</span>].spectra) <span class="op">/</span> <span class="fl">800.0</span></span>
<span id="cb13-53"><a href="#cb13-53" aria-hidden="true" tabindex="-1"></a>      y <span class="op">=</span> y <span class="op">-</span> y.<span class="bu">min</span>()</span>
<span id="cb13-54"><a href="#cb13-54" aria-hidden="true" tabindex="-1"></a>      <span class="co">#plt.cla()</span></span>
<span id="cb13-55"><a href="#cb13-55" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb13-56"><a href="#cb13-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-57"><a href="#cb13-57" aria-hidden="true" tabindex="-1"></a>      fig <span class="op">=</span> plt.figure(figsize<span class="op">=</span>(<span class="dv">15</span>,<span class="dv">6</span>))</span>
<span id="cb13-58"><a href="#cb13-58" aria-hidden="true" tabindex="-1"></a>      ax <span class="op">=</span> plt.axes()</span>
<span id="cb13-59"><a href="#cb13-59" aria-hidden="true" tabindex="-1"></a>      <span class="co"># 2021-0717-161618-720442-spec.json</span></span>
<span id="cb13-60"><a href="#cb13-60" aria-hidden="true" tabindex="-1"></a>      ttl <span class="op">=</span> xx.split(sep<span class="op">=</span><span class="st">'-'</span>)</span>
<span id="cb13-61"><a href="#cb13-61" aria-hidden="true" tabindex="-1"></a>      water <span class="op">=</span> hs.is_water(x,y)</span>
<span id="cb13-62"><a href="#cb13-62" aria-hidden="true" tabindex="-1"></a>      mpl.pyplot.title( <span class="ss">f'Date:</span><span class="sc">{</span>ttl[<span class="dv">1</span>]<span class="sc">}</span><span class="ss">, </span><span class="sc">{</span>ttl[<span class="dv">0</span>]<span class="sc">}</span><span class="ss">  HMS:</span><span class="sc">{</span>ttl[<span class="op">-</span><span class="dv">3</span>]<span class="sc">}</span><span class="ss"> utc  </span><span class="sc">{</span>water<span class="sc">:4.4f}</span><span class="ss"> '</span>, fontsize<span class="op">=</span><span class="dv">20</span>)</span>
<span id="cb13-63"><a href="#cb13-63" aria-hidden="true" tabindex="-1"></a>      mpl.pyplot.ylim(<span class="dv">0</span>,<span class="dv">256</span>)</span>
<span id="cb13-64"><a href="#cb13-64" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> X_Axis <span class="op">==</span> <span class="st">"Wavelength (nm)"</span>:</span>
<span id="cb13-65"><a href="#cb13-65" aria-hidden="true" tabindex="-1"></a>        mpl.pyplot.xlim(<span class="dv">400</span>,<span class="dv">900</span>)</span>
<span id="cb13-66"><a href="#cb13-66" aria-hidden="true" tabindex="-1"></a>        ax.xaxis.set_major_locator(MultipleLocator(<span class="dv">20</span>))</span>
<span id="cb13-67"><a href="#cb13-67" aria-hidden="true" tabindex="-1"></a>        plt.xlabel(<span class="st">'Wavelength (nm)'</span>, fontsize<span class="op">=</span><span class="dv">18</span>)</span>
<span id="cb13-68"><a href="#cb13-68" aria-hidden="true" tabindex="-1"></a>        plt.ylabel(<span class="st">'Digital Counts'</span>, fontsize<span class="op">=</span><span class="dv">18</span>)</span>
<span id="cb13-69"><a href="#cb13-69" aria-hidden="true" tabindex="-1"></a>      <span class="cf">else</span>:</span>
<span id="cb13-70"><a href="#cb13-70" aria-hidden="true" tabindex="-1"></a>        mpl.pyplot.xlim(<span class="dv">0</span>,<span class="dv">1280</span>)</span>
<span id="cb13-71"><a href="#cb13-71" aria-hidden="true" tabindex="-1"></a>        ax.xaxis.set_major_locator(MultipleLocator(<span class="dv">50</span>))</span>
<span id="cb13-72"><a href="#cb13-72" aria-hidden="true" tabindex="-1"></a>        plt.xlabel(<span class="st">'Sensor Pixel Number'</span>, fontsize<span class="op">=</span><span class="dv">18</span>)</span>
<span id="cb13-73"><a href="#cb13-73" aria-hidden="true" tabindex="-1"></a>        plt.ylabel(<span class="st">'Digital Counts'</span>, fontsize<span class="op">=</span><span class="dv">18</span>)</span>
<span id="cb13-74"><a href="#cb13-74" aria-hidden="true" tabindex="-1"></a>      ax.xaxis.grid() <span class="co"># vertical lines</span></span>
<span id="cb13-75"><a href="#cb13-75" aria-hidden="true" tabindex="-1"></a>      plt.plot(x, y, color<span class="op">=</span><span class="st">'green'</span>, linewidth<span class="op">=</span><span class="dv">3</span>, label<span class="op">=</span><span class="st">'Down Looking'</span> )</span>
<span id="cb13-76"><a href="#cb13-76" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> Plot_Fill <span class="op">==</span> <span class="st">"Area Fill"</span>:</span>
<span id="cb13-77"><a href="#cb13-77" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> water <span class="op">&lt;</span> <span class="fl">4.0</span>:</span>
<span id="cb13-78"><a href="#cb13-78" aria-hidden="true" tabindex="-1"></a>          cc <span class="op">=</span> <span class="st">"blue"</span></span>
<span id="cb13-79"><a href="#cb13-79" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb13-80"><a href="#cb13-80" aria-hidden="true" tabindex="-1"></a>          cc <span class="op">=</span> <span class="st">'Brown'</span></span>
<span id="cb13-81"><a href="#cb13-81" aria-hidden="true" tabindex="-1"></a>        plt.fill_between(x,y, alpha<span class="op">=</span><span class="fl">.25</span>, color<span class="op">=</span>cc)</span>
<span id="cb13-82"><a href="#cb13-82" aria-hidden="true" tabindex="-1"></a>      plt.legend()</span>
<span id="cb13-83"><a href="#cb13-83" aria-hidden="true" tabindex="-1"></a>      plt.tight_layout()</span>
<span id="cb13-84"><a href="#cb13-84" aria-hidden="true" tabindex="-1"></a>      clear_output(wait<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb13-85"><a href="#cb13-85" aria-hidden="true" tabindex="-1"></a>      plt.pause(<span class="fl">.2</span>)</span>
<span id="cb13-86"><a href="#cb13-86" aria-hidden="true" tabindex="-1"></a>  <span class="bu">print</span>(<span class="st">'Completed.'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="plot-signals-vs-time" class="level3">
<h3 class="anchored" data-anchor-id="plot-signals-vs-time">Plot Signals vs time</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co">#@title Plot CHL-Fl vs Seconds Of Day { form-width: "30%" }</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="va">__name__</span> <span class="op">==</span> <span class="st">'__main__'</span>:</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  <span class="im">from</span> bokeh.plotting <span class="im">import</span> figure, show</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>  <span class="im">from</span> bokeh.io <span class="im">import</span> output_notebook, show</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>  <span class="im">import</span> bokeh</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> <span class="va">__name__</span> <span class="op">==</span> <span class="st">'__main__'</span>:</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>    bokeh.io.output_notebook()</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>    p <span class="op">=</span> figure(title<span class="op">=</span><span class="st">"Chl Fl"</span>, x_axis_label<span class="op">=</span><span class="st">"Seconds of the day"</span>, y_axis_label<span class="op">=</span><span class="st">"Chl Fl"</span>, width<span class="op">=</span><span class="dv">1000</span>)</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>    p.line(spec_df[<span class="st">'sod'</span>], spec_df[<span class="st">'Chl_Fl'</span>]<span class="op">-</span><span class="dv">10</span>, legend_label<span class="op">=</span><span class="st">"CHL Fl."</span>, color<span class="op">=</span><span class="st">'Red'</span>)</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>    p.line(spec_df[<span class="st">'sod'</span>], spec_df[<span class="st">'fl_700'</span>], legend_label<span class="op">=</span><span class="st">"Fl 700."</span>, color<span class="op">=</span><span class="st">'Blue'</span>)</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>    show(p)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="plot-chl_fl-as-filled-circles-vs-latlon" class="level3">
<h3 class="anchored" data-anchor-id="plot-chl_fl-as-filled-circles-vs-latlon">Plot CHL_Fl as filled circles vs lat/lon</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co">#@title Plot CHL-Fl vs Lat / Lon { form-width: "30%" }</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="va">__name__</span> <span class="op">==</span> <span class="st">'__main__'</span>:</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>  <span class="im">from</span> bokeh.plotting <span class="im">import</span> figure, show</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>  <span class="im">from</span> bokeh.io <span class="im">import</span> output_notebook, show</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>  <span class="im">import</span> bokeh</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> <span class="va">__name__</span> <span class="op">==</span> <span class="st">'__main__'</span>:</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>    bokeh.io.output_notebook()</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>    p <span class="op">=</span> figure(title<span class="op">=</span><span class="st">"Chl Fl"</span>, x_axis_label<span class="op">=</span><span class="st">"Seconds of the day"</span>, y_axis_label<span class="op">=</span><span class="st">"Chl Fl"</span>, width<span class="op">=</span><span class="dv">1000</span>)</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>    p.circle(spec_df[<span class="st">'Lon'</span>], spec_df[<span class="st">'Lat'</span>], legend_label<span class="op">=</span><span class="st">"CHL Fl."</span>, color<span class="op">=</span><span class="st">'Red'</span>, size<span class="op">=</span>(spec_df[<span class="st">'fl_700'</span>])<span class="op">/</span><span class="dv">6</span>)</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>    <span class="co">#p.circle(df['sod'], df['fl_700'], legend_label="Fl 700.", color='Blue')</span></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>    show(p)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
</section>
<section id="code-under-development" class="level1">
<h1>Code under Development</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="op">!</span> cat <span class="op">/</span>content<span class="op">/</span>drive<span class="op">/</span>MyDrive<span class="op">/</span>Missions<span class="op">/</span><span class="dv">2021</span><span class="op">-</span><span class="dv">1208</span><span class="op">-</span>HAB<span class="op">-</span>Lake<span class="op">-</span>Parker<span class="op">/</span><span class="dv">2021</span><span class="op">-</span><span class="dv">1208</span><span class="op">/</span><span class="dv">183807</span><span class="op">/</span><span class="dv">2021</span><span class="op">-</span><span class="dv">1208</span><span class="op">-</span><span class="dv">183605</span><span class="op">-</span><span class="dv">00</span><span class="er">2334</span><span class="op">-</span>flightline<span class="op">-</span>gps.txt <span class="op">/</span>content<span class="op">/</span>drive<span class="op">/</span>MyDrive<span class="op">/</span>Missions<span class="op">/</span><span class="dv">2021</span><span class="op">-</span><span class="dv">1208</span><span class="op">-</span>HAB<span class="op">-</span>Lake<span class="op">-</span>Parker<span class="op">/</span><span class="dv">2021</span><span class="op">-</span><span class="dv">1208</span><span class="op">/</span><span class="dv">190829</span><span class="op">/</span><span class="dv">2021</span><span class="op">-</span><span class="dv">1208</span><span class="op">-</span><span class="dv">190428</span><span class="op">-</span><span class="dv">678619</span><span class="op">-</span>flightline<span class="op">-</span>gps.txt <span class="op">&gt;/</span>content<span class="op">/</span>drive<span class="op">/</span>MyDrive<span class="op">/</span>Missions<span class="op">/</span><span class="dv">2021</span><span class="op">-</span><span class="dv">1208</span><span class="op">-</span>HAB<span class="op">-</span>Lake<span class="op">-</span>Parker<span class="op">/</span><span class="dv">2021</span><span class="op">-</span><span class="dv">1208</span><span class="op">/</span><span class="bu">all</span><span class="op">-</span>gps.txt</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="iterate-over-all-json-and-image-files" class="level2">
<h2 class="anchored" data-anchor-id="iterate-over-all-json-and-image-files">Iterate over all json, and image files</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co">#@title Iterate over all json, and image files { form-width: "30%" }</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="va">__name__</span> <span class="op">==</span> <span class="st">'__main__'</span>:</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>  Root_Path <span class="op">=</span> <span class="st">"/content/2021-0717-HAB-pie-NO-PIX"</span> <span class="co">#@param {type:"string"}</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>  variable_name <span class="op">=</span> <span class="st">""</span> <span class="co">#@param {type:"string"}</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>  <span class="im">from</span> IPython.display <span class="im">import</span> clear_output</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>  <span class="im">import</span> os</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>  <span class="co">#from   matplotlib import rc</span></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>  <span class="co">#from   matplotlib import pyplot as plt</span></span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>  <span class="co">#import matplotlib as mpl</span></span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>  <span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>  <span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>  <span class="im">from</span> pathlib <span class="im">import</span> Path</span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a>  <span class="im">import</span> warnings</span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a>  warnings.filterwarnings(<span class="st">"ignore"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="work-with-files-and-dirs" class="level2">
<h2 class="anchored" data-anchor-id="work-with-files-and-dirs">Work with files and dirs</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co">#@title Add a Colabs Title { form-width: "30%" }</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="va">__name__</span> <span class="op">==</span> <span class="st">'__main__'</span>:</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># From the mission directory, get a complete list of the flightline subdirectories.</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>  <span class="bu">print</span>(<span class="st">'</span><span class="ch">\n</span><span class="st">Testing hs.get_list_of_flight_lines(</span><span class="ch">\'</span><span class="st">/content/drive/MyDrive/Missions/2021-0717-HAB-pie</span><span class="ch">\'</span><span class="st">)'</span>)</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>  flight_line_list <span class="op">=</span> hs.get_list_of_flight_lines(<span class="st">'/content/drive/MyDrive/Missions/2021-0717-HAB-pie'</span>)</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>  <span class="bu">print</span>(<span class="ss">f'</span><span class="ch">\n</span><span class="sc">{</span><span class="bu">len</span>(flight_line_list)<span class="sc">}</span><span class="ss"> Total flightlines found.  flight_line_list[1:5]:'</span>)</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> f <span class="kw">in</span> flight_line_list[<span class="dv">1</span>:<span class="dv">5</span>]:</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>( <span class="ss">f'  </span><span class="sc">{</span>f<span class="sc">}</span><span class="ss">'</span> )</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>  js <span class="op">=</span> hs.get_list_of_hab_files(flight_line_list[<span class="dv">1</span>], subdir<span class="op">=</span><span class="st">'hab_spectra'</span>, ext<span class="op">=</span><span class="st">'json'</span>)</span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>  spec_images <span class="op">=</span> hs.get_list_of_hab_files(flight_line_list[<span class="dv">1</span>], subdir<span class="op">=</span><span class="st">'hab_images'</span>, ext<span class="op">=</span><span class="st">'jpg'</span>)</span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>  <span class="bu">print</span>(<span class="st">''</span>)</span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>  <span class="bu">print</span>(<span class="ss">f'    Spec_Images: </span><span class="sc">{</span><span class="bu">len</span>(spec_images)<span class="sc">:5d}</span><span class="ss">'</span>)</span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a>  <span class="bu">print</span>(<span class="ss">f'Json Spec Files: </span><span class="sc">{</span><span class="bu">len</span>(js)<span class="sc">:5d}</span><span class="ss">'</span> )</span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a>  photos <span class="op">=</span> hs.get_list_of_hab_files(flight_line_list[<span class="dv">1</span>], subdir<span class="op">=</span><span class="st">'hab_rgb'</span>, ext<span class="op">=</span><span class="st">'jpg'</span>)</span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a>  <span class="bu">print</span>(<span class="ss">f'         Photos: </span><span class="sc">{</span><span class="bu">len</span>(photos)<span class="sc">:5d}</span><span class="ss">'</span>)</span>
<span id="cb18-20"><a href="#cb18-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-21"><a href="#cb18-21" aria-hidden="true" tabindex="-1"></a>  flight_lines <span class="op">=</span> hs.get_list_of_flight_lines(<span class="st">'/content/drive/MyDrive/Missions/2021-0717-HAB-pie'</span>)</span>
<span id="cb18-22"><a href="#cb18-22" aria-hidden="true" tabindex="-1"></a>  <span class="bu">print</span>(<span class="ss">f'    FlightLines: </span><span class="sc">{</span><span class="bu">len</span>(flight_lines)<span class="sc">:5d}</span><span class="ss">   </span><span class="sc">{</span>flight_lines[<span class="dv">0</span>:<span class="dv">2</span>]<span class="sc">}</span><span class="ss">'</span>  )</span>
<span id="cb18-23"><a href="#cb18-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-24"><a href="#cb18-24" aria-hidden="true" tabindex="-1"></a>  i <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb18-25"><a href="#cb18-25" aria-hidden="true" tabindex="-1"></a>  t <span class="op">=</span> <span class="bu">len</span>(flight_lines)</span>
<span id="cb18-26"><a href="#cb18-26" aria-hidden="true" tabindex="-1"></a>  all_specs <span class="op">=</span> []</span>
<span id="cb18-27"><a href="#cb18-27" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> fl <span class="kw">in</span> flight_lines:</span>
<span id="cb18-28"><a href="#cb18-28" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Process a single flightline</span></span>
<span id="cb18-29"><a href="#cb18-29" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f'  Flight_line </span><span class="sc">{</span>i<span class="sc">}</span><span class="ss"> of </span><span class="sc">{</span>t<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>fl<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb18-30"><a href="#cb18-30" aria-hidden="true" tabindex="-1"></a>    specs <span class="op">=</span> hs.get_list_of_hab_files(fl, subdir<span class="op">=</span><span class="st">'hab_spectra'</span>, ext<span class="op">=</span><span class="st">'json'</span>)</span>
<span id="cb18-31"><a href="#cb18-31" aria-hidden="true" tabindex="-1"></a>    all_specs.extend(specs)</span>
<span id="cb18-32"><a href="#cb18-32" aria-hidden="true" tabindex="-1"></a>    i <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb18-33"><a href="#cb18-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> s <span class="kw">in</span> specs[<span class="dv">0</span>:<span class="dv">5</span>]:</span>
<span id="cb18-34"><a href="#cb18-34" aria-hidden="true" tabindex="-1"></a>      <span class="co">#print(f'  {s}')</span></span>
<span id="cb18-35"><a href="#cb18-35" aria-hidden="true" tabindex="-1"></a>      <span class="cf">pass</span></span>
<span id="cb18-36"><a href="#cb18-36" aria-hidden="true" tabindex="-1"></a>  <span class="bu">print</span>(<span class="ss">f'</span><span class="sc">{</span>hs<span class="sc">.</span>now_utc()<span class="sc">}</span><span class="ss">: Operation Completed.'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="generate-habspec-class-library" class="level1">
<h1>Generate HabSpec Class library</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co">#@title Clone HabSpec from GitHub and convert to python. { form-width: "30%" }</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Test if running in main.</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="va">__name__</span> <span class="op">==</span> <span class="st">'__main__'</span>:</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>  <span class="op">!</span> git clone https:<span class="op">//</span>github.com<span class="op">/</span>lidar532<span class="op">/</span>RedTideProcessing.git</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>  <span class="op">!</span> cd <span class="op">/</span>content<span class="op">/</span>RedTideProcessing<span class="op">/;</span> jupyter nbconvert <span class="op">--</span>to python hab_process.ipynb</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>  <span class="bu">print</span>(<span class="ss">f'</span><span class="sc">{</span>hs<span class="sc">.</span>now_utc()<span class="sc">}</span><span class="ss">: Operation Completed.'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co">#@title Copy HabSpec from Gdrive to /content/RedTideProcessing { form-width: "30%" }</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Test if running in main.</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="va">__name__</span> <span class="op">==</span> <span class="st">'__main__'</span>:</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>  <span class="im">import</span> datetime</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>  <span class="op">!</span> mkdir <span class="op">-</span>p RedTideProcessing</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>  <span class="op">!</span> cp <span class="op">-</span>v <span class="op">/</span>content<span class="op">/</span>drive<span class="op">/</span>MyDrive<span class="op">/</span>Colab\ Notebooks<span class="op">/</span>hab_process.ipynb <span class="op">/</span>content<span class="op">/</span>RedTideProcessing<span class="op">/</span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>  <span class="bu">print</span>(<span class="ss">f'</span><span class="sc">{</span>datetime<span class="sc">.</span>datetime<span class="sc">.</span>utcnow()<span class="sc">}</span><span class="ss">: Operation Completed.'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co">#@title Convert the HabSpec notebook to python.py { form-width: "30%" }</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Test if running in main.</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="va">__name__</span> <span class="op">==</span> <span class="st">'__main__'</span>:</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>  <span class="op">!</span> cd <span class="op">/</span>content<span class="op">/</span>RedTideProcessing<span class="op">/;</span> jupyter nbconvert <span class="op">--</span>to python hab_process.ipynb</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>  <span class="bu">print</span>(<span class="ss">f'</span><span class="sc">{</span>datetime<span class="sc">.</span>datetime<span class="sc">.</span>utcnow()<span class="sc">}</span><span class="ss">: Conversion Completed.'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="va">__name__</span> <span class="op">==</span> <span class="st">'__main__'</span>:</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>  <span class="op">!</span>rm <span class="op">-</span>rf <span class="op">/</span>content<span class="op">/</span>RedTideProcessing<span class="op">/</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="va">__name__</span> <span class="op">==</span> <span class="st">'__main__'</span>:</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>  <span class="co">#from RedTideProcessing.hab_process import HyperSpec</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>  <span class="im">import</span> RedTideProcessing.hab_process</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="va">__name__</span> <span class="op">==</span> <span class="st">'__main__'</span>:</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>  hhh <span class="op">=</span> RedTideProcessing.hab_process.HyperSpec()</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>  <span class="bu">print</span>(hhh.asof_str, hhh.create_time)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="va">__name__</span> <span class="op">==</span> <span class="st">'__main__'</span>:</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>  RedTideProcessing.hab_process.HyperSpec.asof_str</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="va">__name__</span> <span class="op">==</span> <span class="st">'__main__'</span>:</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>  <span class="bu">reload</span>(RedTideProcessing.hab_process)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co">#@title reload(lib):  Reloads a library after making changes.</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="va">__name__</span> <span class="op">==</span> <span class="st">'__main__'</span>:</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>  <span class="im">from</span> importlib <span class="im">import</span> <span class="bu">reload</span>   <span class="co"># get the reload functions.</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>  <span class="im">import</span> matplotlib <span class="im">as</span> mp        <span class="co"># Load a library</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>  <span class="bu">reload</span>(mp)                     <span class="co"># Reload the library.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="references" class="level1">
<h1>References</h1>
<p><a href="https://www.researchgate.net/figure/Modeled-remote-sensing-reflectance-spectra-for-K-brevis-cell-concentrations-a-greater_fig1_26237728">Novel Optical Techniques for Detecting and Classifying Toxic Dinoflagellate Karenia Brevis Blooms Using Satellite Imagery</a></p>
<hr>
<section id="links" class="level2">
<h2 class="anchored" data-anchor-id="links">Links</h2>
<p><a href="https://github.com/lidar532/RedTideProcessing/blob/main/README.md">Readme.md for RedTideProcessing</a></p>
<p><a href="https://github.com/lidar532/RedTideProcessing/discussions">Discussion</a></p>
<p><a href="https://github.com/lidar532/RedTideProcessing/issues">Issues Tracker</a></p>
<p><a href="https://github.com/lidar532/RedTideProcessing/wiki">RedTideProcessing Wiki</a></p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>